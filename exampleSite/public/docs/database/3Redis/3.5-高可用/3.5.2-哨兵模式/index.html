<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="哨兵模式 #  1 概述 #   哨兵模式是 Redis 的高可用的解决方案之一，由一个或多个哨兵实例组成的哨兵系统可以监视任意多个主服务器，以及这些主服务器属下的所有从服务器，并在被监视的主服务器进入下线状态时，自动将下线主服务器属下的某个从服务器升级为新的主服务器，然后由新的主服务器代替已下线的主服务器继续处理命令请求。 具体示例如下：   下图展示了一个哨兵系统监视服务器的例子，其中：
  用双环图案表示的是当前的主服务器 server1。
  用单环图案表示的是主服务器的三个从服务器 server2、server3、server4。
  server2、server3、server4 三个从服务器正在复制主服务器 server1，而哨兵系统正在监视所有四个服务器。
     假设这时，主服务器 server1 进入下线状态，那么从服务器 server2、server3、server4 对主服务器的复制操作将被终止，并且哨兵系统会察觉到 server1 已下线，如下图所示（下线的服务器用虚线表示）。
   当 server1 的下线时长超过用户设定的下线时长上限时，哨兵系统就会对 server1 执行故障转移操作：
 首先，哨兵系统会挑选server1 属下的其中一个从服务器，并将这个被选中的从服务器升级为新的主服务器。 之后，哨兵系统会向server1 属下的所有从服务器发送新的复制指令，让他们成为新的主服务器的从服务器，当所有从服务器都开始复制新的主服务器时，故障转移操作执行完毕。 另外，哨兵还会继续监视已下线的server1，并在他重新上线时，将他设置为新的主服务器的从服务器。    例如，下图展示了哨兵系统将 server2 升级为新的主服务器，并让服务器 server3 和 server4 成为 server2 的从服务器的过程，之后，如果 server1 重新上线的话，他将被哨兵系统降级为 server2 的从服务器。">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="" />
<meta property="og:description" content="哨兵模式 #  1 概述 #   哨兵模式是 Redis 的高可用的解决方案之一，由一个或多个哨兵实例组成的哨兵系统可以监视任意多个主服务器，以及这些主服务器属下的所有从服务器，并在被监视的主服务器进入下线状态时，自动将下线主服务器属下的某个从服务器升级为新的主服务器，然后由新的主服务器代替已下线的主服务器继续处理命令请求。 具体示例如下：   下图展示了一个哨兵系统监视服务器的例子，其中：
  用双环图案表示的是当前的主服务器 server1。
  用单环图案表示的是主服务器的三个从服务器 server2、server3、server4。
  server2、server3、server4 三个从服务器正在复制主服务器 server1，而哨兵系统正在监视所有四个服务器。
     假设这时，主服务器 server1 进入下线状态，那么从服务器 server2、server3、server4 对主服务器的复制操作将被终止，并且哨兵系统会察觉到 server1 已下线，如下图所示（下线的服务器用虚线表示）。
   当 server1 的下线时长超过用户设定的下线时长上限时，哨兵系统就会对 server1 执行故障转移操作：
 首先，哨兵系统会挑选server1 属下的其中一个从服务器，并将这个被选中的从服务器升级为新的主服务器。 之后，哨兵系统会向server1 属下的所有从服务器发送新的复制指令，让他们成为新的主服务器的从服务器，当所有从服务器都开始复制新的主服务器时，故障转移操作执行完毕。 另外，哨兵还会继续监视已下线的server1，并在他重新上线时，将他设置为新的主服务器的从服务器。    例如，下图展示了哨兵系统将 server2 升级为新的主服务器，并让服务器 server3 和 server4 成为 server2 的从服务器的过程，之后，如果 server1 重新上线的话，他将被哨兵系统降级为 server2 的从服务器。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://books.grayson.top/school-recruitment/docs/database/3Redis/3.5-%E9%AB%98%E5%8F%AF%E7%94%A8/3.5.2-%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F/" /><meta property="article:section" content="docs" />



<title>3.5.2 哨兵模式 | Computer Cookbook School Recruitment</title>
<link rel="manifest" href="/school-recruitment/manifest.json">
<link rel="icon" href="/school-recruitment/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/school-recruitment/book.min.57f7f660871517a5bfcfb5e2de853d806f7e34d94ebd5f3f3bad62e9ddbae209.css" integrity="sha256-V/f2YIcVF6W/z7Xi3oU9gG9&#43;NNlOvV8/O61i6d264gk=" crossorigin="anonymous">
  <script defer src="/school-recruitment/flexsearch.min.js"></script>
  <script defer src="/school-recruitment/en.search.min.ddcf6bcf59f53a854992903fddbc3eb404e9294c5826045ce92334fde6a3e27e.js" integrity="sha256-3c9rz1n1OoVJkpA/3bw&#43;tATpKUxYJgRc6SM0/eaj4n4=" crossorigin="anonymous"></script>

  <script defer src="/school-recruitment/sw.min.07899fc95e217f83f76b676678ae96a3d8d0d0b042f9f17c3f23eec2551b7b12.js" integrity="sha256-B4mfyV4hf4P3a2dmeK6Wo9jQ0LBC&#43;fF8PyPuwlUbexI=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />

  <a href="https://github.com/wpwbb510582246/ComputerCookbook-SchoolRecruitment" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#64CEAA; color:#fff; position: absolute; top: 0; border: 0; right: 0;z-index: 100;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a href="/school-recruitment/"><span>Computer Cookbook School Recruitment</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>






  
<ul>
  
  <li>
    <a href="https://www.grayson.top" target="_blank" rel="noopener">
        Blog
      </a>
  </li>
  
  <li>
    <a href="https://github.com/graysonwp" target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
</ul>






<hr>


  



  
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-353f7a5578fa41dbc42c73ea30fe2255" class="toggle"  />
    <label for="section-353f7a5578fa41dbc42c73ea30fe2255" class="flex justify-between">
      <a role="button" class="">第一章 算法</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-e0c159ebe8e8b165cd558008fb5f5074" class="toggle"  />
    <label for="section-e0c159ebe8e8b165cd558008fb5f5074" class="flex justify-between">
      <a role="button" class="">1、算法框架</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-a9fe725cb6a0f216530b1ac2b85e3b7a" class="toggle"  />
    <label for="section-a9fe725cb6a0f216530b1ac2b85e3b7a" class="flex justify-between">
      <a role="button" class="">1.1 动态规划</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.1-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/1.1.1-%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97/" class="">1.1.1 斐波那契数列</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.1-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/1.1.2-%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98/" class="">1.1.2 背包问题</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.1-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/1.1.3-%E8%B4%AA%E5%BF%83%E7%AE%97%E6%B3%95/" class="">1.1.3 贪心算法</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.1-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/1.1.4-%E5%BA%8F%E5%88%97%E5%92%8C%E6%95%B0%E7%BB%84%E7%B1%BB%E9%97%AE%E9%A2%98/" class="">1.1.4 序列和数组类问题</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.1-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/1.1.5-%E7%BC%96%E8%BE%91%E8%B7%9D%E7%A6%BB/" class="">1.1.5 编辑距离</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.1-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/1.1.6-%E9%AB%98%E6%A5%BC%E6%89%94%E9%B8%A1%E8%9B%8B/" class="">1.1.6 高楼扔鸡蛋</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.1-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/1.1.7-%E8%82%A1%E7%A5%A8%E9%97%AE%E9%A2%98%E7%B3%BB%E5%88%97%E9%80%9A%E8%A7%A3/" class="">1.1.7 股票问题系列通解</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.1-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/1.1.8-%E6%9C%80%E9%95%BF%E6%9C%89%E6%95%88%E6%8B%AC%E5%8F%B7/" class="">1.1.8 最长有效括号</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.1-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/1.1.9-%E8%82%A1%E7%A5%A8%E9%97%AE%E9%A2%98%E7%B3%BB%E5%88%97%E9%80%9A%E8%A7%A3/" class="">1.1.9 股票问题系列通解</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.1-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/1.1.10-%E6%9C%80%E9%95%BF%E9%87%8D%E5%A4%8D%E5%AD%90%E6%95%B0%E7%BB%84/" class="">1.1.10 最长重复子数组</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.1-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/1.1.11-%E6%9C%80%E9%95%BF%E6%9C%89%E6%95%88%E6%8B%AC%E5%8F%B7/" class="">1.1.11 最长有效括号</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-e36081c41f3a4d8d8355cae83c46c9b8" class="toggle"  />
    <label for="section-e36081c41f3a4d8d8355cae83c46c9b8" class="flex justify-between">
      <a role="button" class="">1.2 二分查找</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.2-%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/1.2.1-%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE%E6%A1%86%E6%9E%B6/" class="">1.2.1 二分查找框架</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.2-%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/1.2.2-%E6%90%9C%E7%B4%A2%E6%97%8B%E8%BD%AC%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84/" class="">1.2.2 搜索旋转排序数组</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.2-%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/1.2.3-%E5%A6%82%E4%BD%95%E8%BF%90%E7%94%A8%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE%E7%AE%97%E6%B3%95/" class="">1.2.3 如何运用二分查找算法</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-2ac9691c4865fdec0880b3cb638bc594" class="toggle"  />
    <label for="section-2ac9691c4865fdec0880b3cb638bc594" class="flex justify-between">
      <a role="button" class="">1.3 数据结构</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.3-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/1.3.1-%E5%8F%8D%E8%BD%AC%E9%93%BE%E8%A1%A8/" class="">1.3.1 反转链表</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.3-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/1.3.2-%E7%9B%B8%E4%BA%A4%E9%93%BE%E8%A1%A8/" class="">1.3.2 相交链表</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.3-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/1.3.3-%E9%93%BE%E8%A1%A8%E4%B8%AD%E5%80%92%E6%95%B0%E7%AC%ACk%E4%B8%AA%E8%8A%82%E7%82%B9/" class="">1.3.3 链表中倒数第k个节点</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-2adde4460efeae2e3f7fc587adb365a8" class="toggle"  />
    <label for="section-2adde4460efeae2e3f7fc587adb365a8" class="flex justify-between">
      <a role="button" class="">1.4 排序算法</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.4-%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/1.4.1-%E5%B8%B8%E8%A7%81%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/" class="">1.4.1 常见排序算法</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.4-%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/1.4.2-%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E7%AC%ACk%E4%B8%AA%E6%9C%80%E5%A4%A7%E5%85%83%E7%B4%A0/" class="">1.4.2 数组中的第k个最大元素</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-9b9f975ded87a304ee48569c44f19492" class="toggle"  />
    <label for="section-9b9f975ded87a304ee48569c44f19492" class="flex justify-between">
      <a role="button" class="">1.5 二叉树</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.5-%E4%BA%8C%E5%8F%89%E6%A0%91/1.5.1-%E4%BA%8C%E5%8F%89%E6%A0%91%E9%81%8D%E5%8E%86/" class="">1.5.1 二叉树遍历</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.5-%E4%BA%8C%E5%8F%89%E6%A0%91/1.5.2-%E5%B2%9B%E5%B1%BF%E9%97%AE%E9%A2%98/" class="">1.5.2 岛屿问题</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.5-%E4%BA%8C%E5%8F%89%E6%A0%91/1.5.3-%E5%B9%B3%E8%A1%A1%E4%BA%8C%E5%8F%89%E6%A0%91/" class="">1.5.3 平衡二叉树</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.5-%E4%BA%8C%E5%8F%89%E6%A0%91/1.5.4-%E4%BA%8C%E5%8F%89%E6%A0%91%E8%B7%AF%E5%BE%84%E9%97%AE%E9%A2%98/" class="">1.5.4 二叉树路径问题</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.5-%E4%BA%8C%E5%8F%89%E6%A0%91/1.5.5-%E6%9E%84%E9%80%A0%E4%BA%8C%E5%8F%89%E6%A0%91/" class="">1.5.5 构造二叉树</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.5-%E4%BA%8C%E5%8F%89%E6%A0%91/1.5.6-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E6%9C%80%E8%BF%91%E5%85%AC%E5%85%B1%E7%A5%96%E5%85%88/" class="">1.5.6 二叉树的最近公共祖先</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-4571e95d0021653ce2d27ee4b0838ca0" class="toggle"  />
    <label for="section-4571e95d0021653ce2d27ee4b0838ca0" class="flex justify-between">
      <a role="button" class="">1.6 回溯算法</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.6-%E5%9B%9E%E6%BA%AF%E7%AE%97%E6%B3%95/1.6.1-%E5%9B%9E%E6%BA%AF%E7%AE%97%E6%B3%95%E8%A7%A3%E9%A2%98%E6%A1%86%E6%9E%B6/" class="">1.6.1 回溯算法解题框架</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.6-%E5%9B%9E%E6%BA%AF%E7%AE%97%E6%B3%95/1.6.2-N%E7%9A%87%E5%90%8E/" class="">1.6.2 N皇后</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-d6fac765b0c7fea77c79961a611f9f8f" class="toggle"  />
    <label for="section-d6fac765b0c7fea77c79961a611f9f8f" class="flex justify-between">
      <a role="button" class="">1.7 数组</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.7-%E6%95%B0%E7%BB%84/1.7.1-%E5%88%A0%E9%99%A4%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9/" class="">1.7.1 删除有序数组中的重复项</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.7-%E6%95%B0%E7%BB%84/1.7.2-%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E6%9C%80%E5%A4%A7%E5%80%BC/" class="">1.7.2 滑动窗口最大值</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-07c6c41b5fb22f09768b6f4e1da46596" class="toggle"  />
    <label for="section-07c6c41b5fb22f09768b6f4e1da46596" class="flex justify-between">
      <a role="button" class="">1.8 字符串</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.8-%E5%AD%97%E7%AC%A6%E4%B8%B2/1.8.1-%E6%9C%80%E5%B0%8F%E8%A6%86%E7%9B%96%E5%AD%90%E4%B8%B2/" class="">1.8.1 最小覆盖子串</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.8-%E5%AD%97%E7%AC%A6%E4%B8%B2/1.8.2-%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B8%E4%B9%98/" class="">1.8.2 字符串相乘</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.8-%E5%AD%97%E7%AC%A6%E4%B8%B2/1.8.3-%E6%AF%94%E8%BE%83%E7%89%88%E6%9C%AC%E5%8F%B7/" class="">1.8.3 比较版本号</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.8-%E5%AD%97%E7%AC%A6%E4%B8%B2/1.8.4-%E9%AA%8C%E8%AF%81IP%E5%9C%B0%E5%9D%80/" class="">1.8.4 验证 Ip地址</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/1%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/1.8-%E5%AD%97%E7%AC%A6%E4%B8%B2/1.8.5-%E5%9F%BA%E6%9C%AC%E8%AE%A1%E7%AE%97%E5%99%A8-II/" class="">1.8.5 基本计算器 Ii</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-8b579ed4452b6a8d2017a24343689b5c" class="toggle"  />
    <label for="section-8b579ed4452b6a8d2017a24343689b5c" class="flex justify-between">
      <a role="button" class="">2、高频面试题</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-5a653711e83b11abc9ab6143b1a9fd64" class="toggle"  />
    <label for="section-5a653711e83b11abc9ab6143b1a9fd64" class="flex justify-between">
      <a role="button" class="">2.1 数学</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.1-%E6%95%B0%E5%AD%A6/2.1.1-%E5%BF%AB%E9%80%9F%E6%A8%A1%E5%B9%82%E7%AE%97%E6%B3%95/" class="">2.1.1 快速模幂算法</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.1-%E6%95%B0%E5%AD%A6/2.1.2-%E6%90%9C%E7%B4%A2%E4%BA%8C%E7%BB%B4%E7%9F%A9%E9%98%B5/" class="">2.1.2 搜索二维矩阵</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.1-%E6%95%B0%E5%AD%A6/2.1.3-%E8%9E%BA%E6%97%8B%E7%9F%A9%E9%98%B5/" class="">2.1.3 螺旋矩阵</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.1-%E6%95%B0%E5%AD%A6/2.1.4-x-%E7%9A%84%E5%B9%B3%E6%96%B9%E6%A0%B9/" class="">2.1.4 X 的平方根</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-5c279474332677699cd0b53888bd51ba" class="toggle"  />
    <label for="section-5c279474332677699cd0b53888bd51ba" class="flex justify-between">
      <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.2-%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/" class="">2.2 二分查找</a>
    </label>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-e057e8659d2f838952397ed15d20f46c" class="toggle"  />
    <label for="section-e057e8659d2f838952397ed15d20f46c" class="flex justify-between">
      <a role="button" class="">2.3 数组</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.3-%E6%95%B0%E7%BB%84/2.3.1-%E5%A6%82%E4%BD%95%E5%AF%BB%E6%89%BE%E6%B6%88%E5%A4%B1%E7%9A%84%E5%85%83%E7%B4%A0/" class="">2.3.1 如何寻找消失的元素</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.3-%E6%95%B0%E7%BB%84/2.3.2-%E5%A6%82%E4%BD%95%E5%AF%BB%E6%89%BE%E7%BC%BA%E5%A4%B1%E5%92%8C%E9%87%8D%E5%A4%8D%E7%9A%84%E5%85%83%E7%B4%A0/" class="">2.3.2 如何寻找缺失和重复的元素</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.3-%E6%95%B0%E7%BB%84/2.3.3-%E6%89%BE%E5%87%BA%E6%95%B0%E7%BB%84%E6%B8%B8%E6%88%8F%E7%9A%84%E8%B5%A2%E5%AE%B6/" class="">2.3.3 找出数组游戏的赢家</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.3-%E6%95%B0%E7%BB%84/2.3.4-%E6%9C%80%E5%A4%A7%E6%95%B0/" class="">2.3.4 最大数</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.3-%E6%95%B0%E7%BB%84/2.3.5-%E4%BA%8C%E7%BB%B4%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E6%9F%A5%E6%89%BE/" class="">2.3.5 二维数组中的查找</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.3-%E6%95%B0%E7%BB%84/2.3.6-%E4%B8%A4%E6%95%B0%E4%B9%8B%E5%92%8C/" class="">2.3.6 两数之和</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.3-%E6%95%B0%E7%BB%84/2.3.7-%E4%B8%89%E6%95%B0%E4%B9%8B%E5%92%8C/" class="">2.3.7 三数之和</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.3-%E6%95%B0%E7%BB%84/2.3.8-%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84/" class="">2.3.8 合并两个有序数组</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.3-%E6%95%B0%E7%BB%84/2.3.9-%E4%B8%8B%E4%B8%80%E4%B8%AA%E6%8E%92%E5%88%97/" class="">2.3.9 下一个排列</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.3-%E6%95%B0%E7%BB%84/2.3.10-%E7%BC%BA%E5%A4%B1%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E6%AD%A3%E6%95%B0/" class="">2.3.10 缺失的第一个正数</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.3-%E6%95%B0%E7%BB%84/2.3.11-%E5%AF%BB%E6%89%BE%E4%B8%A4%E4%B8%AA%E6%AD%A3%E5%BA%8F%E6%95%B0%E7%BB%84%E7%9A%84%E4%B8%AD%E4%BD%8D%E6%95%B0/" class="">2.3.11 寻找两个正序数组的中位数</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.3-%E6%95%B0%E7%BB%84/2.3.12-%E5%A4%9A%E6%95%B0%E5%85%83%E7%B4%A0/" class="">2.3.12 多数元素</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.3-%E6%95%B0%E7%BB%84/2.3.13-%E6%9C%80%E9%95%BF%E8%BF%9E%E7%BB%AD%E5%BA%8F%E5%88%97/" class="">2.3.13 最长连续序列</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.3-%E6%95%B0%E7%BB%84/2.3.14-%E7%BB%99%E5%AE%9A%E6%95%B0%E5%AD%97%E8%83%BD%E7%BB%84%E6%88%90%E7%9A%84%E6%9C%80%E5%A4%A7%E6%97%B6%E9%97%B4/" class="">2.3.14 给定数字能组成的最大时间</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-b0bb9f9be9775f7e7856b63f7c5be80e" class="toggle"  />
    <label for="section-b0bb9f9be9775f7e7856b63f7c5be80e" class="flex justify-between">
      <a role="button" class="">2.4 字符串</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.4-%E5%AD%97%E7%AC%A6%E4%B8%B2/2.4.1-%E6%9E%84%E9%80%A0-K-%E4%B8%AA%E5%9B%9E%E6%96%87%E5%AD%97%E7%AC%A6%E4%B8%B2/" class="">2.4.1 构造 K 个回文字符串</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.4-%E5%AD%97%E7%AC%A6%E4%B8%B2/2.4.2-%E5%A6%82%E4%BD%95%E5%AF%BB%E6%89%BE%E6%9C%80%E5%9B%9E%E4%B8%B2/" class="">2.4.2 如何寻找最 回 串</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.4-%E5%AD%97%E7%AC%A6%E4%B8%B2/2.4.3-%E5%A6%82%E4%BD%95%E5%88%A4%E5%AE%9A%E6%8B%AC%E5%8F%B7%E7%9A%84%E5%90%88%E6%B3%95%E6%80%A7/" class="">2.4.3 如何判定括号的合法性</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.4-%E5%AD%97%E7%AC%A6%E4%B8%B2/2.4.4-%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E6%8D%A2%E6%95%B4%E6%95%B0-atoi/" class="">2.4.4 字符串转换整数 (Atoi)</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.4-%E5%AD%97%E7%AC%A6%E4%B8%B2/2.4.5-%E9%95%BF%E5%BA%A6%E4%B8%BA3%E7%9A%84%E4%B8%8D%E5%90%8C%E5%9B%9E%E6%96%87%E5%AD%90%E5%BA%8F%E5%88%97/" class="">2.4.5 长度为3的不同回文子序列</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.4-%E5%AD%97%E7%AC%A6%E4%B8%B2/2.4.6-%E6%97%A0%E9%87%8D%E5%A4%8D%E5%AD%97%E7%AC%A6%E7%9A%84%E6%9C%80%E9%95%BF%E5%AD%90%E4%B8%B2/" class="">2.4.6 无重复字符的最长子串</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.4-%E5%AD%97%E7%AC%A6%E4%B8%B2/2.4.7-%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B8%E5%8A%A0/" class="">2.4.7 字符串相加</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.4-%E5%AD%97%E7%AC%A6%E4%B8%B2/2.4.8-%E7%BF%BB%E8%BD%AC%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%87%8C%E7%9A%84%E5%8D%95%E8%AF%8D/" class="">2.4.8 翻转字符串里的单词</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-c2cc4653d849ecb4e8d0df9162693740" class="toggle"  />
    <label for="section-c2cc4653d849ecb4e8d0df9162693740" class="flex justify-between">
      <a role="button" class="">2.5 链表</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.5-%E9%93%BE%E8%A1%A8/2.5.1-%E7%8E%AF%E5%BD%A2%E9%93%BE%E8%A1%A8-II/" class="">2.5.1 环形链表 Ii</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.5-%E9%93%BE%E8%A1%A8/2.5.2-%E5%A6%82%E4%BD%95%E9%AB%98%E6%95%88%E5%88%A4%E6%96%AD%E5%9B%9E%E6%96%87%E9%93%BE%E8%A1%A8/" class="">2.5.2 如何高效判断回文链表</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.5-%E9%93%BE%E8%A1%A8/2.5.3-%E5%90%88%E5%B9%B6K%E4%B8%AA%E5%8D%87%E5%BA%8F%E9%93%BE%E8%A1%A8/" class="">2.5.3 合并 K个升序链表</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.5-%E9%93%BE%E8%A1%A8/2.5.4-%E7%9B%B8%E4%BA%A4%E9%93%BE%E8%A1%A8/" class="">2.5.4 相交链表</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.5-%E9%93%BE%E8%A1%A8/2.5.5-%E9%93%BE%E8%A1%A8%E4%B8%AD%E5%80%92%E6%95%B0%E7%AC%ACk%E4%B8%AA%E8%8A%82%E7%82%B9/" class="">2.5.5 链表中倒数第k个节点</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.5-%E9%93%BE%E8%A1%A8/2.5.6-%E5%90%88%E5%B9%B6K%E4%B8%AA%E5%8D%87%E5%BA%8F%E9%93%BE%E8%A1%A8/" class="">2.5.6 合并 K个升序链表</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-95a636b3d00f4ce42d96beeef34d9742" class="toggle"  />
    <label for="section-95a636b3d00f4ce42d96beeef34d9742" class="flex justify-between">
      <a role="button" class="">2.6 二叉树</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.6-%E4%BA%8C%E5%8F%89%E6%A0%91/2.6.1-%E5%9C%A8%E4%BA%8C%E5%8F%89%E6%A0%91%E4%B8%AD%E5%88%86%E9%85%8D%E7%A1%AC%E5%B8%81/" class="">2.6.1 在二叉树中分配硬币</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.6-%E4%BA%8C%E5%8F%89%E6%A0%91/2.6.2-%E5%B0%86%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84%E8%BD%AC%E6%8D%A2%E4%B8%BA%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91/" class="">2.6.2 将有序数组转换为二叉搜索树</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.6-%E4%BA%8C%E5%8F%89%E6%A0%91/2.6.4-%E9%87%8D%E5%BB%BA%E4%BA%8C%E5%8F%89%E6%A0%91/" class="">2.6.4 重建二叉树</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.6-%E4%BA%8C%E5%8F%89%E6%A0%91/2.6.5-%E4%BA%8C%E5%8F%89%E6%A0%91%E4%B8%AD%E7%9A%84%E6%9C%80%E5%A4%A7%E8%B7%AF%E5%BE%84%E5%92%8C/" class="">2.6.5 二叉树中的最大路径和</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-2dca4a28932da6fd2ab80d6adf86f380" class="toggle"  />
    <label for="section-2dca4a28932da6fd2ab80d6adf86f380" class="flex justify-between">
      <a role="button" class="">2.7 队列</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.7-%E9%98%9F%E5%88%97/2.7.1-%E7%94%A8%E6%A0%88%E5%AE%9E%E7%8E%B0%E9%98%9F%E5%88%97/" class="">2.7.1 用栈实现队列</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-9868fca37e026543bb4220219b385440" class="toggle"  />
    <label for="section-9868fca37e026543bb4220219b385440" class="flex justify-between">
      <a role="button" class="">2.8 动态规划</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.8-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/2.8.1-%E5%A6%82%E4%BD%95%E9%AB%98%E6%95%88%E8%A7%A3%E5%86%B3%E6%8E%A5%E9%9B%A8%E6%B0%B4%E9%97%AE%E9%A2%98/" class="">2.8.1 如何高效解决接雨水问题</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.8-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/2.8.2-%E6%9C%80%E5%B0%91%E4%BE%A7%E8%B7%B3%E6%AC%A1%E6%95%B0/" class="">2.8.2 最少侧跳次数</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-2b868ec58580c16b57b76d0e583b5ec9" class="toggle"  />
    <label for="section-2b868ec58580c16b57b76d0e583b5ec9" class="flex justify-between">
      <a role="button" class="">2.9 设计</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.9-%E8%AE%BE%E8%AE%A1/2.9.1-%E5%AE%9E%E7%8E%B0-Trie-%E5%89%8D%E7%BC%80%E6%A0%91/" class="">2.9.1 实现 Trie (前缀树)</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/algorithm/2%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98/2.9-%E8%AE%BE%E8%AE%A1/2.9.2-LRU-%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6/" class="">2.9.2 Lru 缓存机制</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-0922907dd56f7a4a192db7338c0e7143" class="toggle"  />
    <label for="section-0922907dd56f7a4a192db7338c0e7143" class="flex justify-between">
      <a role="button" class="">第二章 计算机基础</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-e090ea075956ea0a88f3be27eb8b8174" class="toggle"  />
    <label for="section-e090ea075956ea0a88f3be27eb8b8174" class="flex justify-between">
      <a role="button" class="">1、计算机网络</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-043e7911fd2d67fbc52b823c1516a0d8" class="toggle"  />
    <label for="section-043e7911fd2d67fbc52b823c1516a0d8" class="flex justify-between">
      <a role="button" class="">1.1 传输层： Tcp和 UDP</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/1%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1.1-%E4%BC%A0%E8%BE%93%E5%B1%82TCP%E5%92%8CUDP/1.1.1-%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B/" class="">1.1.1 三次握手</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/1%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1.1-%E4%BC%A0%E8%BE%93%E5%B1%82TCP%E5%92%8CUDP/1.1.2-%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/" class="">1.1.2 四次挥手</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/1%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1.1-%E4%BC%A0%E8%BE%93%E5%B1%82TCP%E5%92%8CUDP/1.1.3-%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6/" class="">1.1.3 流量控制</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/1%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1.1-%E4%BC%A0%E8%BE%93%E5%B1%82TCP%E5%92%8CUDP/1.1.5-%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6/" class="">1.1.5 拥塞控制</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/1%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1.1-%E4%BC%A0%E8%BE%93%E5%B1%82TCP%E5%92%8CUDP/1.1.6-TCP%E5%92%8CUDP%E7%9A%84%E5%8C%BA%E5%88%AB/" class="">1.1.6 Tcp和 Udp的区别</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/1%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1.1-%E4%BC%A0%E8%BE%93%E5%B1%82TCP%E5%92%8CUDP/1.1.7-TCP%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E4%BC%A0%E8%BE%93%E7%9A%84%E5%8F%AF%E9%9D%A0%E6%80%A7/" class="">1.1.7 Tcp如何保证传输的可靠性</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/1%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1.1-%E4%BC%A0%E8%BE%93%E5%B1%82TCP%E5%92%8CUDP/1.1.8-TCP%E9%95%BF%E8%BF%9E%E6%8E%A5%E5%92%8C%E7%9F%AD%E8%BF%9E%E6%8E%A5/" class="">1.1.8 Tcp长连接和短连接</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-c1e479729a89ea5ddbe8dd67b5f3ed4e" class="toggle"  />
    <label for="section-c1e479729a89ea5ddbe8dd67b5f3ed4e" class="flex justify-between">
      <a role="button" class="">1.2 应用层：HTTP和HTTPS</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/1%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1.2-%E5%BA%94%E7%94%A8%E5%B1%82HTTP%E5%92%8CHTTPS/1.2.1-HTTP%E5%92%8CHTTPS%E7%9A%84%E5%8C%BA%E5%88%AB/" class="">1.2.1 Http和 HTTP S的区别</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/1%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1.2-%E5%BA%94%E7%94%A8%E5%B1%82HTTP%E5%92%8CHTTPS/1.2.2-GET%E5%92%8CPOST%E7%9A%84%E5%8C%BA%E5%88%AB/" class="">1.2.2 Get和 Post的区别</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/1%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1.2-%E5%BA%94%E7%94%A8%E5%B1%82HTTP%E5%92%8CHTTPS/1.2.3-Session%E4%B8%8ECookie%E7%9A%84%E5%8C%BA%E5%88%AB/" class="">1.2.3 Session与 Cookie的区别</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/1%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1.2-%E5%BA%94%E7%94%A8%E5%B1%82HTTP%E5%92%8CHTTPS/1.2.4-%E4%BB%8E%E8%BE%93%E5%85%A5%E7%BD%91%E5%9D%80%E5%88%B0%E8%8E%B7%E5%BE%97%E9%A1%B5%E9%9D%A2%E7%9A%84%E8%BF%87%E7%A8%8B%E8%B6%8A%E8%AF%A6%E7%BB%86%E8%B6%8A%E5%A5%BD/" class="">1.2.4 从输入网址到获得页面的过程（越详细越好）</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/1%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1.2-%E5%BA%94%E7%94%A8%E5%B1%82HTTP%E5%92%8CHTTPS/1.2.5-HTTP%E8%AF%B7%E6%B1%82%E6%9C%89%E5%93%AA%E4%BA%9B%E5%B8%B8%E8%A7%81%E7%9A%84%E7%8A%B6%E6%80%81%E7%A0%81/" class="">1.2.5 Http请求有哪些常见的状态码</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/1%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1.2-%E5%BA%94%E7%94%A8%E5%B1%82HTTP%E5%92%8CHTTPS/1.2.6-%E4%BB%80%E4%B9%88%E6%98%AFRIP%E7%AE%97%E6%B3%95%E6%98%AF%E4%BB%80%E4%B9%88/" class="">1.2.6 什么是 Rip，算法是什么</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/1%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1.2-%E5%BA%94%E7%94%A8%E5%B1%82HTTP%E5%92%8CHTTPS/1.2.7-HTTP1.0HTTP1.1%E5%92%8CHTTP2.0%E7%9A%84%E4%B8%BB%E8%A6%81%E5%8C%BA%E5%88%AB/" class="">1.2.7 Http1.0、 Http1.1和 Http2.0的主要区别</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/1%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1.2-%E5%BA%94%E7%94%A8%E5%B1%82HTTP%E5%92%8CHTTPS/1.2.8-DNS/" class="">1.2.8 DNS</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/1%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1.2-%E5%BA%94%E7%94%A8%E5%B1%82HTTP%E5%92%8CHTTPS/1.2.9-HTTPS%E5%8A%A0%E5%AF%86%E5%92%8C%E8%AE%A4%E8%AF%81%E8%BF%87%E7%A8%8B/" class="">1.2.9 HTTP S加密和认证过程</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/1%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1.2-%E5%BA%94%E7%94%A8%E5%B1%82HTTP%E5%92%8CHTTPS/1.2.10-%E5%B8%B8%E8%A7%81%E7%BD%91%E7%BB%9C%E6%94%BB%E5%87%BB/" class="">1.2.10 常见网络攻击</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/1%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1.2-%E5%BA%94%E7%94%A8%E5%B1%82HTTP%E5%92%8CHTTPS/1.2.11-REST/" class="">1.2.11 Rest</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/1%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1.3-%E8%AE%A1%E7%AE%97%E5%85%B6%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/" class="">1.3 计算其网络体系结构</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-9a70073e95afd0aa2b7107f6cb77a3ce" class="toggle"  />
    <label for="section-9a70073e95afd0aa2b7107f6cb77a3ce" class="flex justify-between">
      <a role="button" class="">1.4 网络层协议</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/1%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1.4-%E7%BD%91%E7%BB%9C%E5%B1%82%E5%8D%8F%E8%AE%AE/1.4.1-IP%E5%9C%B0%E5%9D%80%E7%9A%84%E5%88%86%E7%B1%BB/" class="">1.4.1 Ip地址的分类</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/1%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1.4-%E7%BD%91%E7%BB%9C%E5%B1%82%E5%8D%8F%E8%AE%AE/1.4.2-%E5%88%92%E5%88%86%E5%AD%90%E7%BD%91/" class="">1.4.2 划分子网</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/1%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1.4-%E7%BD%91%E7%BB%9C%E5%B1%82%E5%8D%8F%E8%AE%AE/1.4.3-%E4%BB%80%E4%B9%88%E6%98%AFARP%E5%8D%8F%E8%AE%AE/" class="">1.4.3 什么是 Arp协议</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/1%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1.4-%E7%BD%91%E7%BB%9C%E5%B1%82%E5%8D%8F%E8%AE%AE/1.4.4-NAT%E5%8D%8F%E8%AE%AE/" class="">1.4.4 Nat协议</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-09f7d8995bc26810475d1c56597a312e" class="toggle"  />
    <label for="section-09f7d8995bc26810475d1c56597a312e" class="flex justify-between">
      <a role="button" class="">2、操作系统</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-2f767bf946d6dc8ddeda6b6435471e5b" class="toggle"  />
    <label for="section-2f767bf946d6dc8ddeda6b6435471e5b" class="flex justify-between">
      <a role="button" class="">2.1 进程和线程</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/2%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2.1-%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/2.1.1-%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%8C%BA%E5%88%AB/" class="">2.1.1 进程和线程的区别</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/2%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2.1-%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/2.1.2-%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1%E6%96%B9%E5%BC%8F/" class="">2.1.2 进程间通信方式</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/2%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2.1-%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/2.1.3-%E8%BF%9B%E7%A8%8B%E5%90%8C%E6%AD%A5%E9%97%AE%E9%A2%98/" class="">2.1.3 进程同步问题</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/2%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2.1-%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/2.1.4-%E8%BF%9B%E7%A8%8B%E6%9C%89%E5%93%AA%E5%87%A0%E7%A7%8D%E7%8A%B6%E6%80%81/" class="">2.1.4 进程有哪几种状态</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/2%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2.1-%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/2.1.5-%E8%BF%9B%E7%A8%8B%E8%B0%83%E5%BA%A6%E7%AD%96%E7%95%A5/" class="">2.1.5 进程调度策略</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/2%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2.1-%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/2.1.6-%E5%83%B5%E5%B0%B8%E8%BF%9B%E7%A8%8B%E5%92%8C%E5%AD%A4%E5%84%BF%E8%BF%9B%E7%A8%8B/" class="">2.1.6 僵尸进程和孤儿进程</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/2%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2.1-%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/2.1.7-%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5/" class="">2.1.7 线程同步</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/2%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2.1-%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/2.1.8-%E5%8D%8F%E7%A8%8B/" class="">2.1.8 协程</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/2%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2.1-%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/2.1.9-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/" class="">2.1.9 异常控制流</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/2%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2.1-%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/2.1.10-IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/" class="">2.1.10 Io多路复用</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/2%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2.1-%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/2.1.11-%E7%94%A8%E6%88%B7%E6%80%81%E5%92%8C%E5%86%85%E6%A0%B8%E6%80%81/" class="">2.1.11 用户态和内核态</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/2%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2.2-%E6%AD%BB%E9%94%81/" class="">2.2 死锁</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-b2b1a78994c9898abed1b08fef134abd" class="toggle"  />
    <label for="section-b2b1a78994c9898abed1b08fef134abd" class="flex justify-between">
      <a role="button" class="">2.3 内存管理</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/2%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2.3-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/2.3.1-%E5%88%86%E9%A1%B5%E5%92%8C%E5%88%86%E6%AE%B5/" class="">2.3.1 分页和分段</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/2%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2.3-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/2.3.2-%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98/" class="">2.3.2 虚拟内存</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/2%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2.3-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/2.3.3-%E9%A1%B5%E9%9D%A2%E7%BD%AE%E6%8D%A2%E7%AE%97%E6%B3%95/" class="">2.3.3 页面置换算法</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/2%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2.3-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/2.3.4-%E5%B1%80%E9%83%A8%E6%80%A7%E5%8E%9F%E7%90%86/" class="">2.3.4 局部性原理</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/2%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2.3-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/2.3.5-%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA/" class="">2.3.5 缓冲区溢出</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/computer-basics/2%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2.4-%E7%A3%81%E7%9B%98%E8%B0%83%E5%BA%A6/" class="">2.4 磁盘调度</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-e28cc33fe5745d14abf4a0147d0624a5" class="toggle" checked />
    <label for="section-e28cc33fe5745d14abf4a0147d0624a5" class="flex justify-between">
      <a role="button" class="">第三章 数据库</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-6fd3cab540793410b1ce567d790deadc" class="toggle"  />
    <label for="section-6fd3cab540793410b1ce567d790deadc" class="flex justify-between">
      <a role="button" class="">1、数据库基础</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/1%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/1.1-%E4%BA%8B%E5%8A%A1%E7%9A%84%E6%A6%82%E5%BF%B5%E5%92%8C%E7%89%B9%E6%80%A7/" class="">1.1 事务的概念和特性</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/1%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/1.2-%E9%94%81/" class="">1.2 锁</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/1%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/1.3-%E9%94%81%E5%8D%8F%E8%AE%AE/" class="">1.3 锁协议</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/1%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/1.4-%E4%BA%8B%E5%8A%A1%E6%97%A5%E5%BF%97/" class="">1.4 事务日志</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/1%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/1.5-MVCC%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/" class="">1.5 Mvcc实现原理</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-12290256fbd76ac6014c39648c5827fe" class="toggle"  />
    <label for="section-12290256fbd76ac6014c39648c5827fe" class="flex justify-between">
      <a role="button" class="">1.6 基础知识</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/1%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/1.6-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/1.6.1-%E4%B8%89%E8%8C%83%E5%BC%8F/" class="">1.6.1 三范式</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/1%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/1.6-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/1.6.2-%E5%A4%9A%E8%A1%A8%E8%BF%9E%E6%8E%A5%E6%96%B9%E5%BC%8F/" class="">1.6.2 多表连接方式</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/1%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/1.6-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/1.6.3-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/" class="">1.6.3 存储过程</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/1%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/1.6-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/1.6.4-DELETETRUNCATE%E5%92%8CDROP%E7%9A%84%E5%8C%BA%E5%88%AB/" class="">1.6.4 Delete、 Truncate和 Drop的区别</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/1%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/1.6-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/1.6.5-%E8%A7%A6%E5%8F%91%E5%99%A8/" class="">1.6.5 触发器</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/1%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/1.6-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/1.6.6-%E8%A7%86%E5%9B%BE/" class="">1.6.6 视图</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-d1b14978df09adfe15777e58b9b435ec" class="toggle"  />
    <label for="section-d1b14978df09adfe15777e58b9b435ec" class="flex justify-between">
      <a role="button" class="">2、 My SQL</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/2MySQL/2.1-%E7%B4%A2%E5%BC%95/" class="">2.1 索引</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/2MySQL/2.2-B-%E6%A0%91B&#43;%E6%A0%91%E7%B4%A2%E5%BC%95%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86/" class="">2.2 B 树、 B 树索引算法原理</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/2MySQL/2.3-%E7%B4%A2%E5%BC%95%E7%BB%84%E7%BB%87%E8%A1%A8/" class="">2.3 索引组织表</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/2MySQL/2.4-InnoDB%E5%92%8CMyISAM%E7%9A%84%E5%8C%BA%E5%88%AB/" class="">2.4 Inno Db和 My Isam的区别</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/2MySQL/2.5-Checkpoint%E6%8A%80%E6%9C%AF/" class="">2.5 Checkpoint技术</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/2MySQL/2.6-%E5%AE%95%E6%9C%BA%E6%81%A2%E5%A4%8D%E5%8E%9F%E7%90%86/" class="">2.6 宕机恢复原理</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/2MySQL/2.7-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96/" class="">2.7 数据库优化</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/2MySQL/2.8-%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8/" class="">2.8 分库分表</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/2MySQL/2.9-%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/" class="">2.9 一致性哈希算法</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/2MySQL/2.10-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" class="">2.10 主从复制</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-53f351d3e26dfa58c34e937b76a0c4ce" class="toggle" checked />
    <label for="section-53f351d3e26dfa58c34e937b76a0c4ce" class="flex justify-between">
      <a role="button" class="">3、 Redis</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-356f36d039b40fdb10be19d36f2f2793" class="toggle"  />
    <label for="section-356f36d039b40fdb10be19d36f2f2793" class="flex justify-between">
      <a role="button" class="">3.1 概述</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/3Redis/3.1-%E6%A6%82%E8%BF%B0/3.1.1-%E4%B8%BA%E4%BB%80%E4%B9%88Redis%E5%8D%95%E7%BA%BF%E7%A8%8B%E8%BF%98%E8%BF%99%E4%B9%88%E5%BF%AB/" class="">3.1.1 为什么 Redis单线程还这么快</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/3Redis/3.1-%E6%A6%82%E8%BF%B0/3.1.2-Redis%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" class="">3.1.2 Redis数据类型</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/3Redis/3.1-%E6%A6%82%E8%BF%B0/3.1.3-%E6%8C%81%E4%B9%85%E5%8C%96%E6%9C%BA%E5%88%B6/" class="">3.1.3 持久化机制</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/3Redis/3.1-%E6%A6%82%E8%BF%B0/3.1.4-%E8%BF%87%E6%9C%9F%E6%9C%BA%E5%88%B6%E5%92%8C%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5/" class="">3.1.4 过期机制和内存淘汰策略</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/3Redis/3.2-%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B/" class="">3.2 线程模型</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-4731e97839509d5614da88af39acf326" class="toggle"  />
    <label for="section-4731e97839509d5614da88af39acf326" class="flex justify-between">
      <a role="button" class="">3.3 分布式问题</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/3Redis/3.3-%E5%88%86%E5%B8%83%E5%BC%8F%E9%97%AE%E9%A2%98/3.3.1-Redis%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" class="">3.3.1 Redis实现分布式锁</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-555105a060edfd5dfac44ac6d49d31e5" class="toggle"  />
    <label for="section-555105a060edfd5dfac44ac6d49d31e5" class="flex justify-between">
      <a role="button" class="">3.4 缓存异常</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/3Redis/3.4-%E7%BC%93%E5%AD%98%E5%BC%82%E5%B8%B8/3.4.1-%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9/" class="">3.4.1 缓存穿透、缓存击穿、缓存雪崩</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-c0c910bcaee9694f45ce547519533401" class="toggle" checked />
    <label for="section-c0c910bcaee9694f45ce547519533401" class="flex justify-between">
      <a role="button" class="">3.5 高可用</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/3Redis/3.5-%E9%AB%98%E5%8F%AF%E7%94%A8/3.5.1-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" class="">3.5.1 主从复制</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/3Redis/3.5-%E9%AB%98%E5%8F%AF%E7%94%A8/3.5.2-%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F/" class=" active">3.5.2 哨兵模式</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/database/3Redis/3.5-%E9%AB%98%E5%8F%AF%E7%94%A8/3.5.3-%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F/" class="">3.5.3 集群模式</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-f0d841e400bf38796a65a65ef72b420e" class="toggle"  />
    <label for="section-f0d841e400bf38796a65a65ef72b420e" class="flex justify-between">
      <a role="button" class="">第四章 设计模式</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/design-pattern/1%E6%A6%82%E8%BF%B0/" class="">1、概述</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-e796a2fc1bf6b4e9454f5a191dd15040" class="toggle"  />
    <label for="section-e796a2fc1bf6b4e9454f5a191dd15040" class="flex justify-between">
      <a role="button" class="">2、创建型模式</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/design-pattern/2%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/2.1-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" class="">2.1 单例模式</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/design-pattern/2%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/2.2-%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/" class="">2.2 工厂模式</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-3b4fedfe13cb3a0b79e49b4087294cb6" class="toggle"  />
    <label for="section-3b4fedfe13cb3a0b79e49b4087294cb6" class="flex justify-between">
      <a role="button" class="">3、结构型模式</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/design-pattern/3%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F/3.1-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/" class="">3.1 代理模式</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/design-pattern/3%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F/3.2-%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F/" class="">3.2 装饰器模式</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-0f94fb8c7e53c880650621fdcc596283" class="toggle"  />
    <label for="section-0f94fb8c7e53c880650621fdcc596283" class="flex justify-between">
      <a role="button" class="">4、行为型模式</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/design-pattern/4%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/4.1-%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/" class="">4.1 策略模式</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-eca69da21de5b0cd25d8421dec09a327" class="toggle"  />
    <label for="section-eca69da21de5b0cd25d8421dec09a327" class="flex justify-between">
      <a role="button" class="">第五章 Java</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-a64d861c08691e8f06f1178d4d28cf04" class="toggle"  />
    <label for="section-a64d861c08691e8f06f1178d4d28cf04" class="flex justify-between">
      <a role="button" class="">1、 Java基础</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/java/1Java%E5%9F%BA%E7%A1%80/1.1-StringStringBuffer%E5%92%8CStringBuilder%E7%9A%84%E5%8C%BA%E5%88%AB/" class="">1.1 String、 String Buffer和 String Builder的区别</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/java/1Java%E5%9F%BA%E7%A1%80/1.2-HashMap%E5%92%8CConcurrentHashMap%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/" class="">1.2 Hash Map和 Concurrent Hash Map实现原理</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/java/1Java%E5%9F%BA%E7%A1%80/1.3-ArrayList%E5%92%8CLinkedList%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/" class="">1.3 Array List和 Linked List实现原理</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/java/1Java%E5%9F%BA%E7%A1%80/1.4-%E6%B7%B1%E6%8B%B7%E8%B4%9D%E4%B8%8E%E6%B5%85%E6%8B%B7%E8%B4%9D/" class="">1.4 深拷贝与浅拷贝</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/java/1Java%E5%9F%BA%E7%A1%80/1.5-%E6%8A%BD%E8%B1%A1%E7%B1%BB%E4%B8%8E%E6%8E%A5%E5%8F%A3/" class="">1.5 抽象类与接口</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-21d6c85d1bc3cd657a462ac4b09f9d02" class="toggle"  />
    <label for="section-21d6c85d1bc3cd657a462ac4b09f9d02" class="flex justify-between">
      <a role="button" class="">2、 Java多线程</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/java/2Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/2.1-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%9A%84%E4%B8%89%E5%A4%A7%E7%89%B9%E6%80%A7/" class="">2.1 并发编程的三大特性</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/java/2Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/2.2-%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92/" class="">2.2 指令重排</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/java/2Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/2.3-Volatile%E5%8E%9F%E7%90%86/" class="">2.3 Volatile原理</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/java/2Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/2.4-CAS%E5%8E%9F%E7%90%86/" class="">2.4 Cas原理</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/java/2Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/2.5-Java%E7%9A%844%E7%A7%8D%E5%BC%95%E7%94%A8%E7%BA%A7%E5%88%AB/" class="">2.5 Java的4种引用级别</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/java/2Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/2.6-Java%E4%B8%AD%E7%9A%84%E9%94%81/" class="">2.6 Java中的锁</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/java/2Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/2.7-Synchronized%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/" class="">2.7 Synchronized实现原理</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/java/2Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/2.8-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/" class="">2.8 线程池实现原理</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/java/2Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/2.9-AQS/" class="">2.9 Aqs</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-65e183c484720f91ba3d1676e1ed5a16" class="toggle"  />
    <label for="section-65e183c484720f91ba3d1676e1ed5a16" class="flex justify-between">
      <a role="button" class="">3、 Jvm</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/java/3JVM/3.1-%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F/" class="">3.1 运行时数据区域</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/java/3JVM/3.2-%E5%88%A4%E6%96%AD%E5%AF%B9%E8%B1%A1%E6%98%AF%E5%90%A6%E5%AD%98%E6%B4%BB%E7%9A%84%E6%96%B9%E6%B3%95/" class="">3.2 判断对象是否存活的方法</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/java/3JVM/3.3-%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E7%AE%97%E6%B3%95/" class="">3.3 垃圾收集算法</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/java/3JVM/3.4-%E7%B1%BB%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%92%8C%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B/" class="">3.4 类的生命周期和加载过程</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/java/3JVM/3.5-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%97%B6%E6%9C%BA/" class="">3.5 类加载时机</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/java/3JVM/3.6-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E7%9A%84%E7%A7%8D%E7%B1%BB/" class="">3.6 类加载器的种类</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/java/3JVM/3.7-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6%E7%9A%84%E7%89%B9%E7%82%B9/" class="">3.7 类加载机制的特点</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/java/3JVM/3.8-JVM%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84/" class="">3.8 Jvm内存结构</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/java/3JVM/3.9-%E5%B8%B8%E8%A7%81%E7%9A%84%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E7%AE%97%E6%B3%95%E6%9C%89%E5%93%AA%E4%BA%9B/" class="">3.9 常见的垃圾收集算法有哪些</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/java/3JVM/3.10-%E6%8C%87%E9%92%88%E7%A2%B0%E6%92%9E%E5%92%8C%E7%A9%BA%E9%97%B2%E5%88%97%E8%A1%A8/" class="">3.10 指针碰撞和空闲列表</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/java/3JVM/3.11-%E5%B8%B8%E8%A7%81%E7%9A%84%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E6%9C%89%E5%93%AA%E4%BA%9B/" class="">3.11 常见的垃圾收集器有哪些</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/java/3JVM/3.12-%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%E4%B8%8E%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E7%9A%84%E5%8C%BA%E5%88%AB/" class="">3.12 内存溢出与内存泄漏的区别</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/java/3JVM/3.13-%E5%B8%B8%E7%94%A8%E7%9A%84JVM%E5%90%AF%E5%8A%A8%E5%8F%82%E6%95%B0%E6%9C%89%E5%93%AA%E4%BA%9B/" class="">3.13 常用的 Jvm启动参数有哪些</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/java/3JVM/3.14-%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/" class="">3.14 反射机制</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-78e3fdb9e302e0ddb1abf0723557c671" class="toggle"  />
    <label for="section-78e3fdb9e302e0ddb1abf0723557c671" class="flex justify-between">
      <a role="button" class="">4、 Nio</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/java/4NIO/4.1-%E6%A6%82%E8%BF%B0/" class="">4.1 概述</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-0dcecbd4b31fcc19e26278b6dbaa0d33" class="toggle"  />
    <label for="section-0dcecbd4b31fcc19e26278b6dbaa0d33" class="flex justify-between">
      <a role="button" class="">第六章 Spring全家桶</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-afe35ec73fb23fd24d05388dd4f6d178" class="toggle"  />
    <label for="section-afe35ec73fb23fd24d05388dd4f6d178" class="flex justify-between">
      <a role="button" class="">1、 Spring</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/spring-family/1Spring/1.1-%E6%A6%82%E8%BF%B0/" class="">1.1 概述</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/spring-family/1Spring/1.2-Spring-IOC/" class="">1.2 Spring Ioc</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/spring-family/1Spring/1.3-Spring-AOP/" class="">1.3 Spring Aop</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-b63cda05fe80f821d31813480ebd8acb" class="toggle"  />
    <label for="section-b63cda05fe80f821d31813480ebd8acb" class="flex justify-between">
      <a role="button" class="">2、 Spring Boot</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://books.grayson.top/school-recruitment/docs/spring-family/2SpringBoot/2.1-SpringSpringBootSpringCloud%E7%9A%84%E8%81%94%E7%B3%BB%E4%B8%8E%E5%8C%BA%E5%88%AB/" class="">2.1 Spring、 Spring Boot、 Spring Cloud的联系与区别</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/school-recruitment/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>3.5.2 哨兵模式</strong>

  <label for="toc-control">
    
    <img src="/school-recruitment/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML"> </script>
  <script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]} })</script>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#哨兵模式">哨兵模式</a>
      <ul>
        <li><a href="#1-概述">1 概述</a></li>
        <li><a href="#2-原理">2 原理</a>
          <ul>
            <li><a href="#21-初始化哨兵">2.1 初始化哨兵</a>
              <ul>
                <li><a href="#211-初始化服务器">2.1.1 初始化服务器</a></li>
                <li><a href="#212-使用哨兵专用代码">2.1.2 使用哨兵专用代码</a></li>
                <li><a href="#213-初始化哨兵状态">2.1.3 初始化哨兵状态</a></li>
                <li><a href="#214-初始化哨兵状态的-masters-属性">2.1.4 初始化哨兵状态的 masters 属性</a></li>
                <li><a href="#215-创建连向主服务器的网络连接">2.1.5 创建连向主服务器的网络连接</a></li>
              </ul>
            </li>
            <li><a href="#22-获取主服务器信息">2.2 获取主服务器信息</a></li>
            <li><a href="#23-获取从服务器信息">2.3 获取从服务器信息</a></li>
            <li><a href="#24-向主服务器和从服务器发送信息">2.4 向主服务器和从服务器发送信息</a></li>
            <li><a href="#25-接收来自主服务器和从服务器的频道信息">2.5 接收来自主服务器和从服务器的频道信息</a>
              <ul>
                <li><a href="#251-更新-sentinels-字典">2.5.1 更新 sentinels 字典</a></li>
                <li><a href="#252-创建连向其他哨兵的命令连接">2.5.2 创建连向其他哨兵的命令连接</a></li>
              </ul>
            </li>
            <li><a href="#26-检测主观下线状态">2.6 检测主观下线状态</a></li>
            <li><a href="#27-检查客观下线状态">2.7 检查客观下线状态</a>
              <ul>
                <li><a href="#271-发送-sentinel-is-master-down-by-addr-命令">2.7.1 发送 SENTINEL is-master-down-by-addr 命令</a></li>
                <li><a href="#272-接收-sentinel-is-master-down-by-addr-命令">2.7.2 接收 SENTINEL is-master-down-by-addr 命令</a></li>
                <li><a href="#273-接收-sentinel-is-master-down-by-addr-命令的回复">2.7.3 接收 SENTINEL is-master-down-by-addr 命令的回复</a></li>
              </ul>
            </li>
            <li><a href="#28-选举领头哨兵">2.8 选举领头哨兵</a></li>
            <li><a href="#29-故障转移">2.9 故障转移</a>
              <ul>
                <li><a href="#291-选出新的主服务器">2.9.1 选出新的主服务器</a></li>
                <li><a href="#292-修改从服务器的复制目标">2.9.2 修改从服务器的复制目标</a></li>
                <li><a href="#293-将旧的主服务器变为从服务器">2.9.3 将旧的主服务器变为从服务器</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#参考文献">参考文献</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="哨兵模式">
  哨兵模式
  <a class="anchor" href="#%e5%93%a8%e5%85%b5%e6%a8%a1%e5%bc%8f">#</a>
</h1>
<h2 id="1-概述">
  1 概述
  <a class="anchor" href="#1-%e6%a6%82%e8%bf%b0">#</a>
</h2>
<ol>
<li>哨兵模式<strong>是 Redis 的高可用的解决方案之一</strong>，<strong>由一个或多个哨兵实例组成的哨兵系统可以监视任意多个主服务器</strong>，<strong>以及这些主服务器属下的所有从服务器</strong>，<strong>并在被监视的主服务器进入下线状态时</strong>，<strong>自动将下线主服务器属下的某个从服务器升级为新的主服务器</strong>，<strong>然后由新的主服务器代替已下线的主服务器继续处理命令请求</strong>。</li>
<li>具体示例如下：
<ol>
<li>
<p>下图展示了一个哨兵系统监视服务器的例子，其中：</p>
<ol>
<li>
<p>用双环图案表示的是当前的主服务器 <code>server1</code>。</p>
</li>
<li>
<p>用单环图案表示的是主服务器的三个从服务器 <code>server2</code>、<code>server3</code>、<code>server4</code>。</p>
</li>
<li>
<p><code>server2</code>、<code>server3</code>、<code>server4</code> 三个从服务器正在复制主服务器 <code>server1</code>，而哨兵系统正在监视所有四个服务器。</p>
<p>
  <img src="../../../media/202111/2021-11-13_111031_844116.png" alt="" /></p>
</li>
</ol>
</li>
<li>
<p>假设这时，主服务器 <code>server1</code> 进入下线状态，那么从服务器 <code>server2</code>、<code>server3</code>、<code>server4</code> 对主服务器的复制操作将被终止，并且哨兵系统会察觉到 <code>server1</code> 已下线，如下图所示（下线的服务器用虚线表示）。</p>
<p>
  <img src="../../../media/202111/2021-11-13_111258_352165.png" alt="" /></p>
</li>
<li>
<p>当 <code>server1</code> 的下线时长超过用户设定的下线时长上限时，哨兵系统就会对 <code>server1</code> 执行故障转移操作：</p>
<ol>
<li>首先，哨兵系统会挑选<code>server1</code> 属下的其中一个从服务器，并将这个被选中的从服务器升级为新的主服务器。</li>
<li>之后，哨兵系统会向<code>server1</code> 属下的所有从服务器发送新的复制指令，让他们成为新的主服务器的从服务器，当所有从服务器都开始复制新的主服务器时，故障转移操作执行完毕。</li>
<li>另外，哨兵还会继续监视已下线的<code>server1</code>，并在他重新上线时，将他设置为新的主服务器的从服务器。</li>
</ol>
</li>
<li>
<p>例如，下图展示了哨兵系统将 <code>server2</code> 升级为新的主服务器，并让服务器 <code>server3</code> 和 <code>server4</code> 成为 <code>server2</code> 的从服务器的过程，之后，如果 <code>server1</code> 重新上线的话，他将被哨兵系统降级为 <code>server2</code> 的从服务器。</p>
<p>
  <img src="../../../media/202111/2021-11-13_112350_363498.png" alt="" /></p>
<p>
  <img src="../../../media/202111/2021-11-13_112416_578407.png" alt="" /></p>
</li>
</ol>
</li>
</ol>
<h2 id="2-原理">
  2 原理
  <a class="anchor" href="#2-%e5%8e%9f%e7%90%86">#</a>
</h2>
<h3 id="21-初始化哨兵">
  2.1 初始化哨兵
  <a class="anchor" href="#21-%e5%88%9d%e5%a7%8b%e5%8c%96%e5%93%a8%e5%85%b5">#</a>
</h3>
<ol>
<li>当一个哨兵启动时，他需要执行以下步骤：
<ol>
<li><strong>初始化服务器</strong>。</li>
<li><strong>将普通 Redis 服务器使用的代码替换成哨兵专用代码</strong>。</li>
<li><strong>初始化哨兵状态</strong>。</li>
<li><strong>根据给定的配置文件</strong>，<strong>初始化哨兵的监视主服务器列表</strong>。</li>
<li><strong>创建连向主服务器的网络连接</strong>。</li>
</ol>
</li>
</ol>
<h4 id="211-初始化服务器">
  2.1.1 初始化服务器
  <a class="anchor" href="#211-%e5%88%9d%e5%a7%8b%e5%8c%96%e6%9c%8d%e5%8a%a1%e5%99%a8">#</a>
</h4>
<ol>
<li>首先，因为<strong>哨兵本质上只是一个运行在特殊模式下的 Redis 服务器</strong>，所以<strong>启动哨兵的第一步</strong>，<strong>就是初始化一个普通的 Redis 服务器</strong>，具体步骤如下：
<ol>
<li><strong>初始化服务器状态结构</strong>：
<ol>
<li>
<p>初始化服务器的第一步就是<strong>创建一个 <code>struct redisServer</code> 类型的实例变量 <code>server</code> 作为服务器的状态</strong>，<strong>并为结构中的各个属性设置默认值</strong>。</p>
</li>
<li>
<p>初始化 <code>server</code> 变量的工作由 <code>redis.c/initServerConfig</code> 函数完成，以下是这个函数最开头的一部分代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">initServerConfig</span>(<span style="color:#66d9ef">void</span>) {
    <span style="color:#66d9ef">int</span> j;

    <span style="color:#75715e">//  设置服务器的运行 id
</span><span style="color:#75715e"></span>    getRandomHexChars(server.runid,REDIS_RUN_ID_SIZE);
    <span style="color:#75715e">//  设置默认配置文件路径
</span><span style="color:#75715e"></span>    server.configfile <span style="color:#f92672">=</span> NULL;
    <span style="color:#75715e">//  设置默认服务器频率
</span><span style="color:#75715e"></span>    server.hz <span style="color:#f92672">=</span> REDIS_DEFAULT_HZ;
    <span style="color:#75715e">//  为运行 id 加上结尾字符
</span><span style="color:#75715e"></span>    server.runid[REDIS_RUN_ID_SIZE] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;\0&#39;</span>;
    <span style="color:#75715e">//  设置服务器的运行架构
</span><span style="color:#75715e"></span>    server.arch_bits <span style="color:#f92672">=</span> (<span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">long</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">8</span>) <span style="color:#f92672">?</span> <span style="color:#ae81ff">64</span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">32</span>;
    <span style="color:#75715e">//  设置默认服务器端口号
</span><span style="color:#75715e"></span>    server.port <span style="color:#f92672">=</span> REDIS_SERVERPORT;

    <span style="color:#75715e">//  ...
</span><span style="color:#75715e"></span>}
</code></pre></div></li>
<li>
<p><code>initServerConfig</code> 函数完成的主要工作如下：</p>
<ol>
<li><strong>设置服务器的运行 ID</strong>。</li>
<li><strong>设置服务器的默认运行频率</strong>。</li>
<li><strong>设置服务器的默认配置文件路径</strong>。</li>
<li><strong>设置服务器的运行架构</strong>。</li>
<li><strong>设置服务器的默认端口号</strong>。</li>
<li><strong>设置服务器的默认
  <a href="https://notebook.grayson.top/project-37/doc-806/#2-1-RDB">RDB</a>持久化条件和
  <a href="https://notebook.grayson.top/project-37/doc-806/#2-2-AOF">AOF</a>持久化条件</strong>。</li>
<li><strong>初始化服务器的 LRU 时钟</strong>。</li>
<li><strong>创建命令表</strong>。</li>
</ol>
</li>
</ol>
</li>
<li><strong>载入配置项</strong>：
<ol>
<li>服务器在<strong>用 <code>initServerConfig</code> 函数初始化完 <code>server</code> 变量之后</strong>，<strong>就会开始载入用户给定的配置参数和配置文件</strong>，并<strong>根据用户设定的配置</strong>，<strong>对 <code>server</code> 变量相关属性的值进行修改</strong>。</li>
</ol>
</li>
<li><strong>初始化服务器数据结构</strong>：
<ol>
<li>
<p>在之前<strong>执行 <code>initServerConfig</code> 函数初始化 <code>server</code> 状态时</strong>，<strong>程序只创建了命令表一个数据结构</strong>，不过除了命令表之外，服务器状态还包含其他数据结构，例如：</p>
<ol>
<li><strong><code>server.clients</code> 链表</strong>，这个链表<strong>记录了所有与服务器相连的客户端的状态结构</strong>，<strong>链表的每个节点都包含了一个 <code>redisClient</code> 结构实例</strong>。</li>
<li><strong><code>server.db</code> 数组</strong>，数组中<strong>包含了服务器的所有数据库</strong>。</li>
<li><strong><code>server.pubsub_channels</code> 字典</strong>，用于<strong>保存频道订阅信息</strong>。</li>
<li><strong><code>server.pubsub_patterns</code> 链表</strong>，用于<strong>保存模式订阅信息</strong>。</li>
<li><strong><code>server.lua</code></strong>，用于<strong>保存执行 <code>Lua</code> 脚本的 <code>Lua</code> 环境</strong>。</li>
<li><strong><code>server.slowlog</code></strong>，用于<strong>保存慢查询日志</strong>。</li>
</ol>
</li>
<li>
<p>当初始化服务器进行到这一步，服务器将<strong>调用 <code>initSerer</code> 函数</strong>，<strong>为以上提到的数据结构分配内存</strong>，<strong>并在有需要时</strong>，<strong>为这些数据结构设置或者关联初始化值</strong>。</p>
</li>
<li>
<p><strong>服务器到现在才初始化数据结构的原因在于服务器必须先载入用户指定的配置选项</strong>，<strong>然后才能正确地对数据结构进行初始化</strong>，<strong>如果在执行 <code>initServerConfig</code> 函数时就对数据结构进行初始化</strong>，<strong>那么一旦用户通过配置选项修改了和数据结构有关的服务器状态属性</strong>，<strong>服务器就要重新调整和修改已创建的数据结构</strong>，<strong>为了避免出现这种麻烦的情况</strong>，<strong>服务器选择了将 <code>server</code> 状态的初始化分为两步进行</strong>，<code>initServerConfig</code><strong>函数主要负责初始化一般属性</strong>，而 <code>initServer</code><strong>函数主要负责初始化数据结构</strong>。</p>
</li>
<li>
<p>除了初始化数据结构之外，<code>initServer</code> 还进行了一些非常重要的设置操作，其中包括：</p>
<ol>
<li><strong>为服务器设置进行信号处理器</strong>。</li>
<li><strong>创建共享对象</strong>，这些对象<strong>包含 Redis 服务器经常用到的一些值</strong>，例如包含<code>OK</code> 回复的字符串对象、包含<code>ERR</code> 回复的字符串对象、包含整数 1 到 10000 的字符串对象等，<strong>服务器通过重用这些共享对象来避免反复创建相同的对象</strong>。</li>
<li><strong>打开服务器的监听端口</strong>，并<strong>为监听套接字关联
  <a href="https://notebook.grayson.top/project-37/doc-807/#2-1-2-%E6%96%87%E4%BB%B6%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E5%99%A8">连接应答事件处理器</a></strong>，<strong>等待服务器正式运行时接收客户端的连接</strong>。</li>
<li><strong>为 
  <a href="https://notebook.grayson.top/project-37/doc-807/#2-2-3-%E5%AE%9E%E4%BE%8B-serverCron%E5%87%BD%E6%95%B0">serverCron</a> 函数创建
  <a href="https://notebook.grayson.top/project-37/doc-807/#2-2-%E6%97%B6%E9%97%B4%E4%BA%8B%E4%BB%B6">时间事件</a></strong>，<strong>等待服务器正式运行时执行 serverCron 函数</strong>。</li>
<li><strong>如果
  <a href="https://notebook.grayson.top/project-37/doc-806/#2-2-AOF">AOF</a>持久化功能已经打开</strong>，<strong>那么打开现有的 AOF 文件</strong>，<strong>如果 AOF 文件不存在</strong>，<strong>那么创建并打开一个新的 AOF 文件</strong>，<strong>为 AOF 写入做好准备</strong>。</li>
<li><strong>初始化服务器的后台 I/O 模块</strong>，<strong>为将来的 I/O 操作做好准备</strong>。</li>
</ol>
</li>
</ol>
</li>
<li><strong>还原数据库状态</strong>：
<ol>
<li>在完成了对服务器状态<code>server</code> 变量的初始化之后，服务器需要<strong>载入 RDB 文件或者 AOF 文件</strong>，<strong>并根据文件记录的内容来还原服务器的数据库状态</strong>。</li>
<li>根据服务器是否启用了 AOF 持久化功能，服务器载入数据时所使用的目标文件会有所不同：
<ol>
<li>如果<strong>服务器启用了 AOF 持久化功能</strong>，那么<strong>服务器使用 AOF 文件来还原数据库状态</strong>。</li>
<li>相反地，如果服务器<strong>没有启用 AOF 持久化功能</strong>，那么<strong>服务器使用 RDB 文件来还原数据库状态</strong>。</li>
</ol>
</li>
</ol>
</li>
<li><strong>执行事件循环</strong>：
<ol>
<li>在初始化的最后一步，将开始<strong>执行服务器的事件循环</strong>，至此，服务器的初始化工作圆满完成，服务器现在开始<strong>可以接受客户端的连接请求</strong>，<strong>并处理客户端发来的命令请求了</strong>。</li>
</ol>
</li>
</ol>
</li>
<li>不过，因为<strong>哨兵执行的工作和普通 Redis 服务器执行的工作不同</strong>，所以<strong>哨兵的初始化过程和普通 Redis 服务器的初始化过程并不完全相同</strong>，例如，普通服务器在初始化时会通过载入 RDB 文件或者 AOF 文件来还原数据库状态，但是因为哨兵并不使用数据库，所以初始化哨兵时就不会载入 RDB 文件或者 AOF 文件。</li>
</ol>
<h4 id="212-使用哨兵专用代码">
  2.1.2 使用哨兵专用代码
  <a class="anchor" href="#212-%e4%bd%bf%e7%94%a8%e5%93%a8%e5%85%b5%e4%b8%93%e7%94%a8%e4%bb%a3%e7%a0%81">#</a>
</h4>
<ol>
<li>启动哨兵的第二个步骤就是<strong>将一部分普通 Redis 服务器使用的代码替换成哨兵专用代码</strong>，例如：
<ol>
<li>
<p>普通 Redis 服务器使用 <code>redis.h/REDIS_SERVERPORT</code> 常量的值作为服务器端口，而哨兵则使用 <code>sentinel.c/REDIS_SENTINEL_PORT</code> 常量的值作为服务器端口。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#75715e">#define REDIS_SERVERPORT        6379
</span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#75715e">#define REDIS_SENTINEL_PORT 26379
</span></code></pre></div></li>
<li>
<p>普通 Redis 使用 <code>redis.c/redisCommandTable</code> 作为服务器的命令表，而哨兵使用 <code>sentinel.c/sentinelcmds</code> 作为服务器的命令表，并且其中的 <code>INFO</code> 命令会使用哨兵模式下的专用实现 <code>sentinel.c/sentinelInfoCommand</code> 函数，而不是普通 Redis 服务器使用的实现 <code>redis.c/infoCommand</code> 函数。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">redisCommand</span> redisCommandTable[] <span style="color:#f92672">=</span> {
    {<span style="color:#e6db74">&#34;get&#34;</span>,getCommand,<span style="color:#ae81ff">2</span>,<span style="color:#e6db74">&#34;rF&#34;</span>,<span style="color:#ae81ff">0</span>,NULL,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>},
    {<span style="color:#e6db74">&#34;set&#34;</span>,setCommand,<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>,<span style="color:#e6db74">&#34;wm&#34;</span>,<span style="color:#ae81ff">0</span>,NULL,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>},
    {<span style="color:#e6db74">&#34;setnx&#34;</span>,setnxCommand,<span style="color:#ae81ff">3</span>,<span style="color:#e6db74">&#34;wmF&#34;</span>,<span style="color:#ae81ff">0</span>,NULL,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>},
    <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>    {<span style="color:#e6db74">&#34;pfcount&#34;</span>,pfcountCommand,<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>,<span style="color:#e6db74">&#34;r&#34;</span>,<span style="color:#ae81ff">0</span>,NULL,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>},
    {<span style="color:#e6db74">&#34;pfmerge&#34;</span>,pfmergeCommand,<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>,<span style="color:#e6db74">&#34;wm&#34;</span>,<span style="color:#ae81ff">0</span>,NULL,<span style="color:#ae81ff">1</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>},
    {<span style="color:#e6db74">&#34;pfdebug&#34;</span>,pfdebugCommand,<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>,<span style="color:#e6db74">&#34;w&#34;</span>,<span style="color:#ae81ff">0</span>,NULL,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>},
    {<span style="color:#e6db74">&#34;latency&#34;</span>,latencyCommand,<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>,<span style="color:#e6db74">&#34;arslt&#34;</span>,<span style="color:#ae81ff">0</span>,NULL,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>}
};
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">redisCommand</span> sentinelcmds[] <span style="color:#f92672">=</span> {
    {<span style="color:#e6db74">&#34;ping&#34;</span>,pingCommand,<span style="color:#ae81ff">1</span>,<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#ae81ff">0</span>,NULL,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>},
    {<span style="color:#e6db74">&#34;sentinel&#34;</span>,sentinelCommand,<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>,<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#ae81ff">0</span>,NULL,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>},
    {<span style="color:#e6db74">&#34;subscribe&#34;</span>,subscribeCommand,<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>,<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#ae81ff">0</span>,NULL,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>},
    {<span style="color:#e6db74">&#34;unsubscribe&#34;</span>,unsubscribeCommand,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#ae81ff">0</span>,NULL,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>},
    {<span style="color:#e6db74">&#34;psubscribe&#34;</span>,psubscribeCommand,<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>,<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#ae81ff">0</span>,NULL,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>},
    {<span style="color:#e6db74">&#34;punsubscribe&#34;</span>,punsubscribeCommand,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#ae81ff">0</span>,NULL,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>},
    {<span style="color:#e6db74">&#34;publish&#34;</span>,sentinelPublishCommand,<span style="color:#ae81ff">3</span>,<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#ae81ff">0</span>,NULL,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>},
    {<span style="color:#e6db74">&#34;info&#34;</span>,sentinelInfoCommand,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#ae81ff">0</span>,NULL,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>},
    {<span style="color:#e6db74">&#34;role&#34;</span>,sentinelRoleCommand,<span style="color:#ae81ff">1</span>,<span style="color:#e6db74">&#34;l&#34;</span>,<span style="color:#ae81ff">0</span>,NULL,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>},
    {<span style="color:#e6db74">&#34;client&#34;</span>,clientCommand,<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>,<span style="color:#e6db74">&#34;rs&#34;</span>,<span style="color:#ae81ff">0</span>,NULL,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>},
    {<span style="color:#e6db74">&#34;shutdown&#34;</span>,shutdownCommand,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#ae81ff">0</span>,NULL,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>}
};
</code></pre></div><p><code>sentinelcmds</code> 命令表也解释了为什么在哨兵模式下，Redis 服务器不能执行诸如 <code>SET</code>、<code>DBSIZE</code>、<code>EVAL</code> 等这些命令，因为服务器根本没有在命令表中载入这些命令，<code>PING</code>、<code>SENTINEL</code>、<code>SUBSCRIBE</code>、<code>UNSUBSCRIBE</code>、<code>PSUBSCRIBE</code>、<code>PUNSUBSCRIBE</code>、<code>PUBLISH</code>、<code>INFO</code>、<code>ROLE</code>、<code>CLIENT</code>、<code>SHUTDOWN</code> 这十一个命令就是客户端可以对哨兵执行的全部命令。</p>
</li>
</ol>
</li>
</ol>
<h4 id="213-初始化哨兵状态">
  2.1.3 初始化哨兵状态
  <a class="anchor" href="#213-%e5%88%9d%e5%a7%8b%e5%8c%96%e5%93%a8%e5%85%b5%e7%8a%b6%e6%80%81">#</a>
</h4>
<ol>
<li>
<p>在应用了哨兵的专用代码之后，接下来，服务器会<strong>初始化一个 <code>sentinel.c/sentinelState</code> 结构</strong>，这个结构<strong>保存了服务器中所有和哨兵有关的状态</strong>（服务器的一般状态仍然由 <code>redis.h/redisServer</code> 结构保存）。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">sentinelState</span> {
    <span style="color:#75715e">//  当前纪元，用于实现故障转移
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">uint64_t</span> current_epoch;
    <span style="color:#75715e">//  保存了所有被这个哨兵监视的主服务器，字典的键是主服务器的名字，字典的值则是一个指向 sentinelRedisInstance 结构的指针
</span><span style="color:#75715e"></span>    dict <span style="color:#f92672">*</span>masters;
    <span style="color:#75715e">//  是否进入 TILT 模式
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> tilt;
    <span style="color:#75715e">//  目前正在运行的脚本的数量
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> running_scripts;
    <span style="color:#75715e">//  进入 TILT 模式的时间
</span><span style="color:#75715e"></span>    mstime_t tilt_start_time;
    <span style="color:#75715e">//  最后一次执行事件处理器的时间
</span><span style="color:#75715e"></span>    mstime_t previous_time;
    <span style="color:#75715e">//  一个 FIFO 队列，包含了所有需要执行的用户脚本
</span><span style="color:#75715e"></span>    list <span style="color:#f92672">*</span>scripts_queue;

    <span style="color:#75715e">//  如果不为空，则表示传给其他哨兵的 IP 地址。
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>announce_ip;
    <span style="color:#75715e">//  如果不为 0，则表示传给其他哨兵的端口号
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> announce_port;
} sentinel;
</code></pre></div></li>
</ol>
<h4 id="214-初始化哨兵状态的-masters-属性">
  2.1.4 初始化哨兵状态的 masters 属性
  <a class="anchor" href="#214-%e5%88%9d%e5%a7%8b%e5%8c%96%e5%93%a8%e5%85%b5%e7%8a%b6%e6%80%81%e7%9a%84-masters-%e5%b1%9e%e6%80%a7">#</a>
</h4>
<ol>
<li>
<p><strong>哨兵状态中的 <code>masters</code> 字典中记录了所有被哨兵监视的主服务器的相关信息</strong>，其中<strong>字典的键是被监视主服务器的名字</strong>，<strong>字典的值是被监视主服务器对应的 <code>sentinel.c/sentinelRedisInstance</code> 结构</strong>。</p>
</li>
<li>
<p><strong>每个 <code>sentinelRedisInstance</code> 结构代表一个被哨兵监视的 Redis 服务器实例</strong>，<strong>这个实例可以是主服务器</strong>、<strong>从服务器</strong>、<strong>或者另外一个哨兵</strong>。</p>
</li>
<li>
<p>实例结构包含的属性非常多，以下代码展示了实例结构在表示主服务器时使用的其中一部分属性：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">sentinelRedisInstance</span> {
    <span style="color:#75715e">//  标识值，记录了实例的类型，以及该实例的当前状态
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> flags;      <span style="color:#75715e">/* See SRI_... defines */</span>
    <span style="color:#75715e">//  实例的名字，主服务器的名字由用户在配置文件中配置，从服务器以及哨兵的名字由哨兵自动设置
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>name;     <span style="color:#75715e">/* Master name from the point of view of this sentinel. */</span>
    <span style="color:#75715e">//  实例的运行 ID
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>runid;    <span style="color:#75715e">/* run ID of this instance. */</span>
    <span style="color:#75715e">//  配置纪元，用于实现故障转移
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">uint64_t</span> config_epoch;  <span style="color:#75715e">/* Configuration epoch. */</span>
    <span style="color:#75715e">//  实例的地址
</span><span style="color:#75715e"></span>    sentinelAddr <span style="color:#f92672">*</span>addr; <span style="color:#75715e">/* Master host. */</span>
    <span style="color:#75715e">//  哨兵 down-after-milliseconds 选项设定的值
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//  即实例无响应多少毫秒之后才会判断为主观下线
</span><span style="color:#75715e"></span>    mstime_t down_after_period; <span style="color:#75715e">/* Consider it down after that period. */</span>
    <span style="color:#75715e">//  哨兵 monitor &lt;master-name&gt; &lt;IP&gt; &lt;port&gt; &lt;quorum&gt; 选项中的 quorum 参数
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//  判断这个实例为客观下线所需的支持投票数量
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> quorum;<span style="color:#75715e">/* Number of sentinels that need to agree on failure. */</span>
    <span style="color:#75715e">//  哨兵 parallel-syncs &lt;master-name&gt; &lt;number&gt; 选项的值
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//  在执行故障转移操作时，可以同时对新的主服务器进行同步的从服务器数量
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> parallel_syncs; <span style="color:#75715e">/* How many slaves to reconfigure at same time. */</span>
    <span style="color:#75715e">//  哨兵 failover-timeout &lt;master-name&gt; &lt;ms&gt; 选项的值
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//  刷新故障迁移状态的最大时限
</span><span style="color:#75715e"></span>    mstime_t failover_timeout;      <span style="color:#75715e">/* Max time to refresh failover state. */</span>
} sentinelRedisInstance;
</code></pre></div></li>
<li>
<p><strong>对哨兵状态的初始化将引发对 <code>masters</code> 字典的初始化</strong>，而 <code>masters</code><strong>字典的初始化是根据被载入的哨兵配置文件来进行的</strong>，例如：</p>
<ol>
<li>
<p>用户在启动哨兵时，指定了包含以下内容的配置文件：</p>
<p>
  <img src="../../../media/202111/2021-11-13_153608_636858.png" alt="" /></p>
</li>
<li>
<p>那么哨兵将为主服务器 <code>master1</code>、<code>master2</code> 创建如下图所示的实例结构：</p>
<p>
  <img src="../../../media/202111/2021-11-13_154124_117867.png" alt="" /></p>
<p>
  <img src="../../../media/202111/2021-11-13_154156_171185.png" alt="" /></p>
</li>
<li>
<p>同时，这两个实例结构又回被保存到哨兵状态的 <code>masters</code> 字典中，如下图所示：</p>
<p>
  <img src="../../../media/202111/2021-11-13_154349_001992.png" alt="" /></p>
</li>
</ol>
</li>
</ol>
<h4 id="215-创建连向主服务器的网络连接">
  2.1.5 创建连向主服务器的网络连接
  <a class="anchor" href="#215-%e5%88%9b%e5%bb%ba%e8%bf%9e%e5%90%91%e4%b8%bb%e6%9c%8d%e5%8a%a1%e5%99%a8%e7%9a%84%e7%bd%91%e7%bb%9c%e8%bf%9e%e6%8e%a5">#</a>
</h4>
<ol>
<li>
<p>初始化哨兵的最后一步是<strong>创建连向被监视主服务器的网络连接</strong>，<strong>哨兵将成为主服务器的客户端</strong>，<strong>他可以向主服务器发送命令</strong>，<strong>并从命令回复中获取相关的信息</strong>。</p>
</li>
<li>
<p><strong>对于每个被哨兵监视的主服务器来说</strong>，<strong>哨兵会创建两个连向主服务器的异步网络连接</strong>：</p>
<ol>
<li>一个是<strong>命令连接</strong>，这个连接<strong>专门用于向主服务器发送命令</strong>，<strong>并接收命令回复</strong>。</li>
<li>另一个是<strong>订阅连接</strong>，这个连接<strong>专门用于订阅主服务器的 <code>__sentinel__:hello</code> 频道</strong>。</li>
</ol>
</li>
<li>
<p>下图展示了一个哨兵向被他监视的两个主服务器 <code>master1</code> 和 <code>master2</code> 创建命令连接和订阅连接的例子：</p>
<p>
  <img src="../../../media/202111/2021-11-13_155120_650127.png" alt="" /></p>
<blockquote>
<p>为什么有两个连接？</p>
<ol>
<li><strong>在 Redis 目前的发布与订阅功能中</strong>，<strong>被发送的信息都不会保存在 Redis 服务器里面</strong>，<strong>如果在信息发送时</strong>，<strong>想要接收信息的客户端不在线或者断线</strong>，<strong>那么这个客户端就会丢失这条信息</strong>，因此，<strong>为了不丢失 <code>__sentinel__:hello</code> 频道的任何信息</strong>，<strong>哨兵必须专门用一个订阅连接来接收该频道的信息</strong>。</li>
<li>另一方面，<strong>除了订阅频道之外</strong>，<strong>哨兵还必须向主服务器发送命令</strong>，<strong>以此来与主服务器进行通信</strong>，<strong>所以哨兵还必须向主服务器创建命令连接</strong>。</li>
<li><strong>因为哨兵需要与多个实例创建多个网络连接</strong>，<strong>所以哨兵使用的是异步连接</strong>。</li>
</ol>
</blockquote>
</li>
</ol>
<h3 id="22-获取主服务器信息">
  2.2 获取主服务器信息
  <a class="anchor" href="#22-%e8%8e%b7%e5%8f%96%e4%b8%bb%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%bf%a1%e6%81%af">#</a>
</h3>
<ol>
<li><strong>哨兵默认会以每十秒一次的频率</strong>，<strong>通过命令连接向被监视的主服务器发送 <code>INFO</code> 命令</strong>，<strong>并通过分析 <code>INFO</code> 命令的回复来获取主服务器的当前信息</strong>。</li>
<li>通过分析主服务器返回的<code>INFO</code> 命令回复，哨兵可以获取以下两方面的信息：
<ol>
<li>一方面是<strong>关于主服务器本身的信息</strong>，<strong>包括 <code>run_id</code> 域记录的服务器运行 ID</strong>，<strong>以及 <code>role</code> 域记录的服务器角色</strong>。</li>
<li>另一方面是<strong>关于主服务器属下所有从服务器的信息</strong>，<strong>每个从服务器都由一个 <code>slave</code> 字符串开头的行记录</strong>，<strong>每行的 <code>ip</code> 记录了从服务器的 IP 地址</strong>，而<code>port</code><strong>记录了从服务器的端口号</strong>，<strong>根据这些 IP 地址和端口号</strong>，<strong>哨兵无需用户提供从服务器的地址信息</strong>，<strong>就可以自动发现从服务器</strong>。</li>
</ol>
</li>
<li><strong>根据 <code>run_id</code> 和 <code>role</code> 记录的信息</strong>，<strong>哨兵将对主服务器的实例结构进行更新</strong>，例如主服务器重启之后，他的运行 ID 就会和实例结构之前保存的运行 ID 不同，哨兵检测到这一情况之后，就会对实例结构的运行 ID 进行更新。</li>
<li><strong>至于主服务器返回的从服务器信息</strong>，则<strong>主要用于更新主服务器实例结构的 <code>slaves</code> 字典</strong>，<strong>这个字典记录了主服务器属下从服务器的名单</strong>：
<ol>
<li><strong>字典的键是由哨兵自动设置的从服务器名字</strong>，格式为<code>ip:port</code>，如对于 IP 地址为<code>127.0.0.1</code>，端口号为<code>11111</code> 的从服务器来说，哨兵为他设置的名字就是<code>127.0.0.1:11111</code>。</li>
<li><strong>字典的值则是从服务器对应的实例结构</strong>，例如，如果键是<code>127.0.0.1:11111</code>，那么这个键的值就是 IP 地址为<code>127.0.0.1</code>，端口号为<code>11111</code> 的从服务器的实例结构。</li>
</ol>
</li>
<li><strong>哨兵在分析 <code>INFO</code> 命令中包含的额从服务器信息时</strong>，<strong>会检查从服务器对应的实例结构是否已经存在于 <code>slaves</code> 字典</strong>：
<ol>
<li><strong>如果从服务器对应的实例结构已经存在</strong>，<strong>那么哨兵对从服务器的实例结构进行更新</strong>。</li>
<li><strong>如果从服务器对应的实例结构不存在</strong>，<strong>那么说明这个从服务器是新发现的从服务器</strong>，<strong>哨兵会在 <code>slaves</code> 字典中为这个从服务器新创建一个实例结构</strong>。</li>
</ol>
</li>
<li>具体实例如下：
<ol>
<li>
<p>假如主服务器 <code>master</code> 有三个从服务器 <code>slave0</code>、<code>slave1</code> 和 <code>slave2</code>，并且一个哨兵正在连接主服务器，那么哨兵将持续地向主服务器发送 <code>INFO</code> 命令，并获得类似于以下内容的回复：</p>
<p>
  <img src="../../../media/202111/2021-11-13_160419_866034.png" alt="" /></p>
<p>
  <img src="../../../media/202111/2021-11-13_160544_683093.png" alt="" /></p>
</li>
<li>
<p>从 <code>INFO</code> 命令的回复信息中我们可以得到以下内容：</p>
<ol>
<li>主服务器的相关信息：
<ol>
<li>运行 ID 为<code>7611c59dc3a29aa6fa0609f841bb6a1019008a9c</code>。</li>
<li>服务器角色为<code>master</code>。</li>
</ol>
</li>
<li>从服务器的相关信息：
<ol>
<li>有三个从服务器，<code>ip</code> 地址均为<code>127.0.0.1</code>，端口分别为<code>11111</code>、<code>22222</code>、<code>33333</code>。</li>
</ol>
</li>
</ol>
</li>
<li>
<p>然后哨兵将分别为三个从服务器创建他们各自的实例结构，并将这些结构保存到主服务器实例结构的 <code>slaves</code> 字典里面。</p>
<p>
  <img src="../../../media/202111/2021-11-13_162932_502587.png" alt="" /></p>
<p>上图中主服务器实例结构和从服务器实例结构之间的区别如下：</p>
<ol>
<li>主服务器实例结构的<code>flags</code> 属性的值为<code>SRI_MASTER</code>，而从服务器实例结构的<code>flags</code> 属性的值为<code>SRI_SLAVE</code>。</li>
<li>主服务器实例结构的<code>name</code> 属性的值是用户使用哨兵配置文件设置的，而从服务器实例结构的<code>name</code> 属性的值则是哨兵根据从服务器的 IP 地址和端口号自动设置的。</li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="23-获取从服务器信息">
  2.3 获取从服务器信息
  <a class="anchor" href="#23-%e8%8e%b7%e5%8f%96%e4%bb%8e%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%bf%a1%e6%81%af">#</a>
</h3>
<ol>
<li>
<p><strong>当哨兵发现主服务器有新的从服务器出现时</strong>，<strong>哨兵除了会为这个新的从服务器创建相应的实例结构之外</strong>，<strong>还会创建连接到从服务器的命令连接和订阅连接</strong>。</p>
</li>
<li>
<p><strong>在创建命令连接之后</strong>，<strong>哨兵在默认情况下</strong>，<strong>会以每十秒一次的频率通过命令连接向从服务器发送 <code>INFO</code> 命令</strong>，<strong>并获得类似于以下内容的回复</strong>：</p>
<p>
  <img src="../../../media/202111/2021-11-14_103516_670604.png" alt="" /></p>
</li>
<li>
<p>根据 <code>INFO</code> 命令的回复，哨兵会提取出以下信息：</p>
<ol>
<li><strong>从服务器的运行 ID</strong>：<code>run_id</code>。</li>
<li><strong>从服务器的角色</strong>：<code>role</code>。</li>
<li><strong>主服务器的 IP 地址</strong>：<code>master_host</code>。</li>
<li><strong>主服务器的端口号</strong>：<code>master_port</code>。</li>
<li><strong>主服务器的连接状态</strong>：<code>master_link_status</code>。</li>
<li><strong>从服务器的优先级</strong>：<code>slave_priority</code>。</li>
<li><strong>从服务器的复制偏移量</strong>：<code>slave_repl_offset</code>。</li>
</ol>
</li>
<li>
<p><strong>根据这些信息</strong>，<strong>哨兵会对从服务器的实例结构进行更新</strong>，下图展示了哨兵根据上面的 <code>INFO</code> 命令回复对从服务器的实例结构进行更新之后，实例结构的样子：</p>
<p>
  <img src="../../../media/202111/2021-11-14_104024_620805.png" alt="" /></p>
</li>
</ol>
<h3 id="24-向主服务器和从服务器发送信息">
  2.4 向主服务器和从服务器发送信息
  <a class="anchor" href="#24-%e5%90%91%e4%b8%bb%e6%9c%8d%e5%8a%a1%e5%99%a8%e5%92%8c%e4%bb%8e%e6%9c%8d%e5%8a%a1%e5%99%a8%e5%8f%91%e9%80%81%e4%bf%a1%e6%81%af">#</a>
</h3>
<ol>
<li>
<p>在默认情况下，<strong>哨兵会以每两秒一次的频率</strong>，<strong>通过命令连接向所有被监视的主服务器和从服务器发送以下格式的命令</strong>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">PUBLISH __sentinel__:hello <span style="color:#e6db74">&#34;&lt;s_ip&gt;,&lt;s_port&gt;,&lt;s_runid&gt;,&lt;s_epoch&gt;,&lt;m_name&gt;,&lt;m_ip&gt;,&lt;m_port&gt;,&lt;m_epoch&gt;&#34;</span>
</code></pre></div></li>
<li>
<p>这条命令<strong>向服务器的 <code>__sentinel__:hello</code> 频道发送了一条信息</strong>，信息的内容由多个参数组成：</p>
<ol>
<li><strong>以 <code>s_</code> 开头的参数记录的是哨兵本身的信息</strong>，各个参数的意义为：
<ol>
<li><code>s_ip</code>：哨兵的 IP 地址。</li>
<li><code>s_port</code>：哨兵的端口号。</li>
<li><code>s_runid</code>：哨兵的运行 ID。</li>
</ol>
</li>
<li><strong>以 <code>m_</code> 开头的参数记录的是主服务器的信息</strong>，<strong>如果哨兵正在监视的是主服务器</strong>，<strong>那么这些参数记录的就是主服务器的信息</strong>，<strong>如果哨兵正在监视的是从服务器</strong>，<strong>那么这些参数记录的就是从服务器正在复制的主服务器的信息</strong>，各个参数的意义为：
<ol>
<li><code>m_name</code>：主服务器的名字。</li>
<li><code>m_ip</code>：主服务器的 IP 地址。</li>
<li><code>m_port</code>：主服务器的端口号。</li>
<li><code>m_epoch</code>：主服务器当前的配置纪元。</li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="25-接收来自主服务器和从服务器的频道信息">
  2.5 接收来自主服务器和从服务器的频道信息
  <a class="anchor" href="#25-%e6%8e%a5%e6%94%b6%e6%9d%a5%e8%87%aa%e4%b8%bb%e6%9c%8d%e5%8a%a1%e5%99%a8%e5%92%8c%e4%bb%8e%e6%9c%8d%e5%8a%a1%e5%99%a8%e7%9a%84%e9%a2%91%e9%81%93%e4%bf%a1%e6%81%af">#</a>
</h3>
<ol>
<li>
<p><strong>当哨兵与一个主服务器或者从服务器建立起订阅连接之后</strong>，<strong>哨兵就会通过订阅连接</strong>，<strong>向服务器发送以下命令</strong>：</p>
<pre><code>SUBSCRIBE __sentinel__:hello
</code></pre></li>
<li>
<p><strong>哨兵对 <code>__sentinel:hello</code> 频道的订阅会一直持续到哨兵与服务器的连接断开为止</strong>，也就是说，<strong>对于每个与哨兵连接的服务器</strong>，<strong>哨兵既通过命令连接向服务器的 <code>__sentinel__:hello</code> 频道发送信息</strong>，<strong>又通过订阅连接从服务器的 <code>__sentinel__:hello</code> 频道接收信息</strong>。</p>
<p>
  <img src="../../../media/202111/2021-11-14_110511_555902.png" alt="" /></p>
</li>
<li>
<p><strong>对于监视同一个服务器的多个哨兵来说</strong>，<strong>一个哨兵发送的信息会被其他哨兵接收到</strong>，<strong>这些信息会被用于更新其他哨兵对被监视服务器的认知</strong>。</p>
</li>
<li>
<p>具体实例如下：</p>
<ol>
<li>
<p>假设现在有 <code>sentinel1</code>、<code>sentinel2</code>、<code>sentinel3</code> 三个哨兵在监视同一个服务器，那么当 <code>sentinel1</code> 向服务器的 <code>__sentinel__:hello</code> 频道发送一条信息时，所有订阅了 <code>__sentinel__:hello</code> 频道的哨兵（包括 <code>sentinel1</code> 在内）都会收到这条消息。</p>
<p>
  <img src="../../../media/202111/2021-11-14_111112_849019.png" alt="" /></p>
</li>
<li>
<p>当一个哨兵从 <code>__sentinel__:hello</code> 频道收到一条消息时，哨兵会对这条消息进行分析，提取出信息中的哨兵的 IP 地址、端口号、运行 ID 等八个参数，并进行一下检查：</p>
<ol>
<li>如果信息中记录的哨兵运行 ID 和接收信息的哨兵的运行 ID 相同，那么说明这条信息是哨兵自己发送到，哨兵将丢弃这条信息，不做进一步处理。</li>
<li>相反地，如果信息中记录的哨兵运行 ID 和接收信息的哨兵的运行 ID 不相同，那么说明这条信息是监视同一个服务器的其他哨兵发来的，接收信息的哨兵将根据信息中的各个参数，对相应主服务器的实例结构进行更新。</li>
</ol>
</li>
</ol>
</li>
</ol>
<h4 id="251-更新-sentinels-字典">
  2.5.1 更新 sentinels 字典
  <a class="anchor" href="#251-%e6%9b%b4%e6%96%b0-sentinels-%e5%ad%97%e5%85%b8">#</a>
</h4>
<ol>
<li><strong>哨兵为主服务器创建的实例结构中的 <code>sentinels</code> 字典保存了除哨兵本身之外</strong>，<strong>所有同样监视这个主服务器的其他哨兵的资料</strong>：
<ol>
<li><code>sentinels</code><strong>字典的键是其中一个哨兵的名字</strong>，<strong>格式为 <code>ip:port</code></strong>，比如对于 IP 地址为<code>127.0.0.1</code>，端口号为<code>26379</code> 的哨兵来说，这个哨兵在<code>sentinels</code> 字典中的键就是<code>127.0.0.1:26379</code>。</li>
<li><code>sentinels</code><strong>字典的值则是键所对应哨兵的实例结构</strong>，比如对于<code>127.0.0.1:26379</code> 来说，这个键在<code>sentinels</code> 字典中的值就是 IP 为<code>127.0.0.1</code>，端口号为<code>26379</code> 的哨兵的实例结构。</li>
</ol>
</li>
<li><strong>当一个哨兵接收到其他哨兵发来的信息时</strong>（我们称呼发送信息的哨兵为源哨兵，接收信息的哨兵为目标哨兵），<strong>目标哨兵会从信息中分析并提取出以下两方面参数</strong>：
<ol>
<li><strong>与哨兵有关的参数</strong>：
<ol>
<li><strong>源哨兵的 IP 地址</strong>、<strong>端口号</strong>、<strong>运行 ID 和配置纪元</strong>。</li>
</ol>
</li>
<li><strong>与主服务器有关的参数</strong>：
<ol>
<li><strong>源哨兵正在监视的主服务器的名字</strong>、<strong>IP 地址</strong>、<strong>端口号和配置纪元</strong>。</li>
</ol>
</li>
</ol>
</li>
<li><strong>根据信息中提取的主服务器参数</strong>，<strong>目标哨兵会在自己的哨兵状态的 <code>masters</code> 字典中查找相应的主服务器实例结构</strong>，<strong>然后根据提取出的哨兵参数</strong>，<strong>检查主服务器实例结构的 <code>sentinels</code> 字典中</strong>，<strong>源哨兵的实例结构是否存在</strong>：
<ol>
<li><strong>如果源哨兵的实例结构已经存在</strong>，<strong>那么对源哨兵的实例结构进行更新</strong>。</li>
<li><strong>如果源哨兵的实例结构不存在</strong>，<strong>那么说明源哨兵是刚刚开始监视主服务器的新哨兵</strong>，<strong>目标哨兵会为源哨兵创建一个新的实例结构</strong>，<strong>并将这个结构添加到 <code>sentinels</code> 字典里面</strong>。</li>
</ol>
</li>
<li><strong>因为一个哨兵可以通过分析接收到的频道信息来获知其他哨兵的存在</strong>，<strong>并通过发送频道信息来让其他哨兵知道自己的存在</strong>，<strong>所以用户在使用哨兵的时候并不需要提供各个哨兵的地址信息</strong>，<strong>监视同一个主服务器的多个哨兵可以自动发现对方</strong>。</li>
<li>具体实例如下：
<ol>
<li>
<p>假设分别有 <code>127.0.0.1:26379</code>、<code>127.0.0.1:26380</code>、<code>127.0.0.1:26381</code> 三个哨兵正在监视主服务器 <code>127.0.0.1:6379</code>，那么当 <code>127.0.0.1:26379</code> 这个哨兵接收到以下信息时：</p>
<p>
  <img src="../../../media/202111/2021-11-14_114019_752906.png" alt="" /></p>
<p>哨兵将执行以下动作：</p>
<ol>
<li>第一条信息的发送者为<code>127.0.0.1:26379</code> 自己，这条信息会被忽略。</li>
<li>第二条信息的发送者为<code>127.0.0.1:26381</code>，哨兵会根据这条信息中提取出的内容，对<code>sentinels</code> 字典中<code>127.0.0.1:26381</code> 对应的实例结构进行更新。</li>
<li>第二条信息的发送者为<code>127.0.0.1:26380</code>，哨兵会根据这条信息中提取出的内容，对<code>sentinels</code> 字典中<code>127.0.0.1:26380</code> 对应的实例结构进行更新。</li>
</ol>
</li>
<li>
<p>下图展示了哨兵 <code>127.0.0.1:26379</code> 为主服务器 <code>127.0.0.1:6379</code> 创建的实例结构，以及结构中的 <code>sentinels</code> 字典。</p>
<p>
  <img src="../../../media/202111/2021-11-14_114607_991501.png" alt="" /></p>
</li>
<li>
<p>和 <code>127.0.0.1:26379</code> 一样，其他两个哨兵也会创建类似于上图所示的 <code>sentinels</code> 字典，区别在于字典中保存的哨兵信息不同：</p>
<ol>
<li><code>127.0.0.1:26380</code> 创建的<code>sentinels</code> 字典会保存<code>127.0.0.1:26379</code> 和<code>127.0.0.1:26381</code> 两个哨兵的信息。</li>
<li><code>127.0.0.1:26381</code> 创建的<code>sentinels</code> 字典会保存<code>127.0.0.1:26379</code> 和<code>127.0.0.1:26380</code> 两个哨兵的信息。</li>
</ol>
</li>
</ol>
</li>
</ol>
<h4 id="252-创建连向其他哨兵的命令连接">
  2.5.2 创建连向其他哨兵的命令连接
  <a class="anchor" href="#252-%e5%88%9b%e5%bb%ba%e8%bf%9e%e5%90%91%e5%85%b6%e4%bb%96%e5%93%a8%e5%85%b5%e7%9a%84%e5%91%bd%e4%bb%a4%e8%bf%9e%e6%8e%a5">#</a>
</h4>
<ol>
<li>
<p><strong>当哨兵通过频道信息发现一个新的哨兵时</strong>，<strong>他不仅会为新哨兵在 <code>sentinels</code> 字典中创建相应的实例结构</strong>，<strong>还会创建一个连向新哨兵的命令连接</strong>，而<strong>新哨兵也同样会创建连向这个哨兵的命令连接</strong>，<strong>最终监视同一个主服务器的多个哨兵将形成相互连接的网络</strong>。</p>
<p>
  <img src="../../../media/202111/2021-11-14_143502_711595.png" alt="" /></p>
</li>
<li>
<p><strong>使用命令连接相连的各个哨兵可以通过向其他哨兵发送命令请求来进行信息交换</strong>，下面介绍到的<strong>对哨兵实现主观下线检测和客观下线检测</strong>，<strong>都会使用哨兵之间的命令连接来进行通信</strong>。</p>
<blockquote>
<p>为什么哨兵之间不会创建订阅连接？</p>
<ol>
<li><strong>哨兵在连接主服务器或者从服务器时</strong>，<strong>会同时创建命令连接和订阅连接</strong>，<strong>但是在连接其他哨兵时</strong>，<strong>却只会创建命令连接</strong>，<strong>而不创建订阅连接</strong>。</li>
<li>这是因为<strong>哨兵需要通过接收主服务器或者从服务器发来的频道信息来发现未知的新哨兵</strong>，所以<strong>才需要建立订阅连接</strong>，而<strong>相互已知的哨兵只要使用命令连接来进行通信就足够了</strong>。</li>
</ol>
</blockquote>
</li>
</ol>
<h3 id="26-检测主观下线状态">
  2.6 检测主观下线状态
  <a class="anchor" href="#26-%e6%a3%80%e6%b5%8b%e4%b8%bb%e8%a7%82%e4%b8%8b%e7%ba%bf%e7%8a%b6%e6%80%81">#</a>
</h3>
<ol>
<li>
<p><strong>在默认情况下</strong>，<strong>哨兵会以每秒一次的频率向所有与他创建了命令连接的实例</strong>（包括主服务器、从服务器、其他哨兵在内）<strong>发送 <code>PING</code> 命令</strong>，<strong>并通过实例返回的 <code>PING</code> 命令回复来判断实例是否在线</strong>，下图展示了 <code>Sentinel1</code> 和 <code>Sentinel2</code> 是如何向实例发送 <code>PING</code> 命令的：</p>
<p>
  <img src="../../../media/202111/2021-11-14_151232_418181.png" alt="" /></p>
<ol>
<li><code>Sentinel1</code> 将向<code>Sentinel2</code>、主服务器<code>master</code>、从服务器<code>slave1</code> 和<code>slave2</code> 发送<code>PING</code> 命令。</li>
<li><code>Sentinel2</code> 将向<code>Sentinel1</code>、主服务器<code>master</code>、从服务器<code>slave1</code> 和<code>slave2</code> 发送<code>PING</code> 命令。</li>
</ol>
</li>
<li>
<p><strong>实例对 <code>PING</code> 命令的回复可以分为以下两种情况</strong>：</p>
<ol>
<li><strong>有效回复</strong>：
<ol>
<li><strong>实例返回 <code>+PONG</code></strong>、<code>-LOADING</code>、<code>-MASTERDOWN</code><strong>三种回复中的其中一种</strong>。</li>
</ol>
</li>
<li><strong>无效回复</strong>：
<ol>
<li><strong>实例返回除 <code>+PONG</code></strong>、<code>-LOADING</code>、<code>-MASTERDOWN</code><strong>三种回复之外的其他回复</strong>。</li>
</ol>
</li>
</ol>
</li>
<li>
<p><strong>哨兵配置文件中的 <code>down-after-millseconds</code> 选项指定了哨兵判断实例进入主观下线所需的时间长度</strong>，<strong>如果一个实例在 <code>down-after-millseconds</code> 毫秒内</strong>，<strong>连续向哨兵返回无效回复</strong>，<strong>那么哨兵会修改这个实例所对应的实例结构</strong>，<strong>在结构的 <code>flags</code> 属性中打开 <code>SRI_S_DOWN</code> 标识</strong>，<strong>以此来表示这个实例已经进入主观下线状态</strong>。</p>
<p>
  <img src="../../../media/202111/2021-11-14_152111_684883.png" alt="" /></p>
</li>
<li>
<p>需要注意的是：</p>
<ol>
<li>
<p><strong>用户设置的</strong> <code>down-after-millionseconds</code><strong>选项的值</strong>，<strong>不仅会被哨兵用来判断主服务器的主观下线状态</strong>，<strong>还会被用于判断主服务器属下的所有从服务器</strong>，<strong>以及所有同样监视这个主服务器的其他哨兵的主观下线状态</strong>，例如，如果用户向哨兵设置了以下配置：</p>
<pre><code>sentinel monitor master 127.0.0.1 6379 2
sentinel down-after-millionseconds master 50000
</code></pre><p>那么 50000 毫秒不仅会成为哨兵判断 <code>master</code> 进入主观下线的标准，还会成为哨兵判断 <code>master</code> 属下所有从服务器，以及所有同样监视 <code>master</code> 的其他哨兵进入主观下线的标准。</p>
</li>
<li>
<p><strong>对于监视同一个主服务器的多个哨兵来说</strong>，<strong>这些哨兵所设置的 <code>down-after-millionseconds</code> 选项的值也可能不同</strong>，因此，<strong>当一个哨兵将主服务器判断为主观下线时</strong>，<strong>其他哨兵可能仍然会认为主服务器处于在线状态</strong>，例如，假如 <code>Sentinel1</code> 载入了以下配置：</p>
<pre><code>sentinel monitor master 127.0.0.1 6379 2
sentinel down-after-millionseconds master 50000
</code></pre><p><code>Sentinel2</code> 载入了以下配置：</p>
<pre><code>sentinel monitor master 127.0.0.1 6379 2
sentinel down-after-millionseconds master 10000
</code></pre><p>那么当 <code>master</code> 的断线时长超过 10000 毫秒之后，<code>Sentinel2</code> 会将 <code>master</code> 判断为主观下线，而 <code>Sentinel1</code> 确认为 <code>master</code> 在线，只有当 <code>master</code> 的断线时长超过 50000 毫秒之后，<code>Sentinel1</code> 和 <code>Sentinel2</code> 才会都认为 <code>master</code> 进入了主观下线状态。</p>
</li>
</ol>
</li>
</ol>
<h3 id="27-检查客观下线状态">
  2.7 检查客观下线状态
  <a class="anchor" href="#27-%e6%a3%80%e6%9f%a5%e5%ae%a2%e8%a7%82%e4%b8%8b%e7%ba%bf%e7%8a%b6%e6%80%81">#</a>
</h3>
<ol>
<li><strong>当哨兵将一个主服务器判断为主观下线之后</strong>，<strong>为了确认这个主服务器是否真的下线了</strong>，<strong>他会向同样监视这一主服务器的其它哨兵进行询问</strong>，<strong>看他们是否也认为主服务器已经进入了下线状态</strong>（可以是主观下线或者客观下线）。</li>
<li><strong>当哨兵从其他哨兵那里接收到足够数量的已下线判断之后</strong>，<strong>哨兵就会将服务器判定为客观下线</strong>，<strong>并对主服务器执行故障转移操作</strong>。</li>
</ol>
<h4 id="271-发送-sentinel-is-master-down-by-addr-命令">
  2.7.1 发送 SENTINEL is-master-down-by-addr 命令
  <a class="anchor" href="#271-%e5%8f%91%e9%80%81-sentinel-is-master-down-by-addr-%e5%91%bd%e4%bb%a4">#</a>
</h4>
<ol>
<li>
<p>该命令的使用方法如下：</p>
<pre><code>SENTINEL is-master-down-by-addr &lt;ip&gt; &lt;port&gt; &lt;current_epoch&gt; &lt;runid&gt;
</code></pre></li>
<li>
<p>该命令主要用于<strong>询问其他哨兵是否同意主服务器已下线</strong>，命令中的各个参数的意义如下所示：</p>
<ol>
<li><code>ip</code>：<strong>被哨兵判断为主观下线的主服务器的 IP 地址</strong>。</li>
<li><code>port</code>：<strong>被哨兵判断为主观下线的主服务器的端口号</strong>。</li>
<li><code>current_epoch</code>：<strong>哨兵当前的配置纪元</strong>，<strong>用于选举领头哨兵</strong>。</li>
<li><code>runid</code>：<strong>可以是 <code>*</code> 符号或者哨兵的运行 ID</strong>，其中<code>*</code><strong>表示命令仅仅用于检测主服务器的客观下线状态</strong>，<strong>哨兵的运行 ID 用于选举领头哨兵</strong>。</li>
</ol>
</li>
</ol>
<h4 id="272-接收-sentinel-is-master-down-by-addr-命令">
  2.7.2 接收 SENTINEL is-master-down-by-addr 命令
  <a class="anchor" href="#272-%e6%8e%a5%e6%94%b6-sentinel-is-master-down-by-addr-%e5%91%bd%e4%bb%a4">#</a>
</h4>
<ol>
<li><strong>当一个哨兵</strong>（目标哨兵）<strong>接收到另一个哨兵</strong>（源哨兵）<strong>发来的 <code>SENTINEL is-master-down-by-addr</code> 命令时</strong>，<strong>目标哨兵会分析并取出命令请求中包含的各个参数</strong>，<strong>并根据其中的主服务器 IP 和端口号</strong>，<strong>检查主服务器是否已下线</strong>，<strong>然后向源哨兵返回一条包含三个参数的回复</strong>，具体如下：
<ol>
<li><code>down_state</code>：<strong>目标哨兵对主服务器的检查结果</strong>，<strong>1 代表主服务器已下线</strong>，<strong>0 代表主服务器未下线</strong>。</li>
<li><code>leader_runid</code>：<strong>可以是 <code>*</code> 符号或者目标哨兵的局部领头哨兵的运行 ID</strong>，其中<code>*</code><strong>符号代表命令仅仅用于检测主服务器的下线状态</strong>，而<strong>局部领头哨兵的运行 ID 则用于选举领头哨兵</strong>。</li>
<li><code>leader_epoch</code>：<strong>目标哨兵的局部领头哨兵的配置纪元</strong>，<strong>用于选举领头哨兵</strong>，<strong>仅在 <code>leader_runid</code> 的值不为 <code>*</code> 时有效</strong>，<strong>如果 <code>leader_runid</code> 的值为 <code>*</code></strong>，<strong>那么 <code>leader_epoch</code> 总为 0</strong>。</li>
</ol>
</li>
<li>具体实例如下：
<ol>
<li>
<p>如果一个哨兵返回以下回复作为 <code>SENTINEL is-master-down-by-addr</code>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt">1
*
0
</code></pre></div><p>那么说明哨兵也同意主服务器已下线。</p>
</li>
</ol>
</li>
</ol>
<h4 id="273-接收-sentinel-is-master-down-by-addr-命令的回复">
  2.7.3 接收 SENTINEL is-master-down-by-addr 命令的回复
  <a class="anchor" href="#273-%e6%8e%a5%e6%94%b6-sentinel-is-master-down-by-addr-%e5%91%bd%e4%bb%a4%e7%9a%84%e5%9b%9e%e5%a4%8d">#</a>
</h4>
<ol>
<li>
<p><strong>根据其他哨兵发回的</strong> <code>SENTINEL is-master-down-by-addr</code><strong>命令回复</strong>，<strong>哨兵将统计其他哨兵同意主服务器已下线的数量</strong>，<strong>当这一数量达到配置指定的判断客观下线所需的数量</strong>（哨兵配置中设置的 quorum 参数的值）<strong>时</strong>，<strong>该哨兵就会认为主服务器已经进入客观下线状态</strong>，<strong>然后会将主服务器实例结构 <code>flags</code> 属性的 <code>SRI_O_DON</code> 标识打开</strong>，<strong>表示主服务器已经进入客观下线状态</strong>。</p>
<p>
  <img src="../../../media/202111/2021-11-14_161048_420878.png" alt="" /></p>
<p>例如，如果哨兵在启动时载入了以下配置：</p>
<pre><code>sentinel monitor master 127.0.0.1 6379 2
</code></pre><p>那么包括当前哨兵在内，只要总共有两个哨兵认为主服务器已经进入下线状态，那么当前哨兵就将主服务器判断为客观下线。</p>
</li>
<li>
<p>需要注意的是：</p>
<ol>
<li><strong>对于监视同一个主服务器的多个哨兵来说</strong>，<strong>他们将主服务器判断为客观下线的条件可能也不同</strong>，<strong>当一个哨兵将主服务器判断为客观下线时</strong>，<strong>其他哨兵可能并不是那么认为的</strong>，例如：
<ol>
<li>
<p>对于监视同一个主服务器的五个哨兵来说，如果 <code>Sentinel1</code> 在启动时载入了以下配置：</p>
<pre><code>sentinel monitor master 127.0.0.1 6379 2
</code></pre><p>那么当五个哨兵中有两个哨兵认为主服务器已经下线时，<code>Sentinel1</code> 就会将主服务器判断为客观下线。</p>
</li>
<li>
<p>如果 <code>Sentinel2</code> 在启动时载入了以下配置：</p>
<pre><code>sentinel monitor master 127.0.0.1 6379 5
</code></pre><p>当仅有两个哨兵认为主服务器下线，并不会令 <code>Sentinel2</code> 将主服务器判断为客观下线。</p>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="28-选举领头哨兵">
  2.8 选举领头哨兵
  <a class="anchor" href="#28-%e9%80%89%e4%b8%be%e9%a2%86%e5%a4%b4%e5%93%a8%e5%85%b5">#</a>
</h3>
<ol>
<li><strong>当一个主服务器被判断为客观下线时</strong>，<strong>监视这个下线主服务器的各个哨兵会进行协商</strong>，<strong>选举出一个领头哨兵</strong>，<strong>并由领头哨兵对下线主服务器执行故障转移操作</strong>。</li>
<li><strong>选举领头哨兵的规则和方法如下</strong>：
<ol>
<li><strong>所有在线的哨兵都有被选为领头哨兵的资格</strong>，换句话说，<strong>监视同一个主服务器的多个在线哨兵中的任意一个都有可能成为领头哨兵</strong>。</li>
<li><strong>每次进行领头哨兵选举之后</strong>，<strong>无论选举是否成功</strong>，<strong>所有哨兵的配置纪元</strong>（Configuration Epoch）<strong>的值都会自增一次</strong>，<strong>配置纪元实际上就是一个计数器</strong>，<strong>并没有什么特别的</strong>。</li>
<li><strong>在一个配置纪元里面</strong>，<strong>所有哨兵都有一次将某个哨兵设置为局部领头哨兵的机会</strong>，并且<strong>局部领头一旦设置</strong>，<strong>在这个配置纪元里面就不能再更改</strong>。</li>
<li><strong>每个发现主服务器进入客观下线的哨兵都会要求其他哨兵将自己设置为局部领头哨兵</strong>。</li>
<li><strong>当一个哨兵</strong>（源哨兵）<strong>向另一个哨兵</strong>（目标哨兵）<strong>发送 <code>SENTINEL is-master-down-by-addr</code> 命令</strong>，<strong>并且命令中的 <code>runid</code> 参数不是 <code>*</code> 而是源哨兵的运行 ID 时</strong>，<strong>这表示源哨兵要求目标哨兵将前者设置为后者的局部领头哨兵</strong>。</li>
<li><strong>哨兵设置局部领头哨兵的规则是先到先得</strong>，<strong>最先向目标哨兵发送设置要求的源哨兵将成为目标哨兵的局部领头哨兵</strong>，<strong>而之后接收到的所有设置要求都会被目标哨兵拒绝</strong>。</li>
<li><strong>目标哨兵在接收到 <code>SENTINEL is-master-down-by-addr</code> 命令之后</strong>，<strong>将向源哨兵返回一条命令回复</strong>，<strong>回复中的 <code>leader_runid</code> 参数和 <code>leader_epoch</code> 参数分别记录了目标哨兵的局部领头哨兵的运行 ID 和配置纪元</strong>。</li>
<li><strong>源哨兵在接收到目标哨兵返回的命令回复之后</strong>，<strong>会检查回复中 <code>leader_epoch</code> 参数的值和自己的配置纪元是否相同</strong>，<strong>如果相同的话</strong>，<strong>那么源哨兵继续取出回复中的 <code>leader_runid</code> 参数</strong>，<strong>如果 <code>leader_runid</code> 参数的值和源哨兵的运行 ID 一致</strong>，<strong>那么表示目标哨兵将源哨兵设置成了局部领头哨兵</strong>。</li>
<li><strong>如果有某个哨兵被半数以上的哨兵设置成了局部领头哨兵</strong>，<strong>那么这个哨兵成为领头哨兵</strong>，例如，在一个由 10 个哨兵组成的哨兵系统里面，只要有大于等于<code>10 / 2 + 1 = 6</code> 个哨兵将某个哨兵设置为局部领头哨兵，那么被设置的那个哨兵就会成为领头哨兵。</li>
<li><strong>因为领头哨兵的产生需要半数以上哨兵的支持</strong>，<strong>并且每个哨兵在每个配置纪元里面只能设置一次局部领头哨兵</strong>，<strong>所以在一个配置纪元里面</strong>，<strong>只会出现一个领头哨兵</strong>。</li>
<li><strong>如果在给定时限内</strong>，<strong>没有一个哨兵被选举为领头哨兵</strong>，<strong>那么各个哨兵将在一段时间之后再次进行选举</strong>，<strong>直到选到领头哨兵为止</strong>。</li>
</ol>
</li>
<li>具体实例如下：
<ol>
<li>
<p>假设现在有三个哨兵正在监视同一个主服务器，并且这三个哨兵之前已经通过 <code>SENTINEL is-master-down-by-addr</code> 命令确认主服务器进入了客观下线状态，如下图所示：</p>
<p>
  <img src="../../../media/202111/2021-11-14_165447_497715.png" alt="" /></p>
</li>
<li>
<p>为了选出领头哨兵，三个哨兵将再次向其他哨兵发送 <code>SENTINEL is-master-down-by-addr</code> 命令：</p>
<p>
  <img src="../../../media/202111/2021-11-14_165643_013311.png" alt="" /></p>
</li>
<li>
<p>和检测客观下线状态时发送的 <code>SENTINEL is-master-down-by-addr</code> 命令不同，哨兵这次发送的命令会带有自己的运行 ID，例如 <code>SENTINEL is-master-down-by-addr 127.0.0.1 6379 0 e955b4c85598ef5b5f055bc7ebfd5e828dbed4fa</code>。</p>
</li>
<li>
<p>如果收到这个目录的哨兵还没有设置局部领头哨兵的话，他就会将运行 ID 为 <code>e955b4c85598ef5b5f055bc7ebfd5e828dbed4fa</code> 的哨兵设置为自己的局部领头哨兵，并返回类似以下的命令回复：</p>
<pre><code>1
e955b4c85598ef5b5f055bc7ebfd5e828dbed4fa
0
</code></pre></li>
<li>
<p>然后接收到命令回复的哨兵就可以根据这一回复，统计出有多少个哨兵将自己设置成了局部领头哨兵。</p>
</li>
<li>
<p>根据命令请求发送的先后顺序不同，可能会有某个哨兵的 <code>SENTINEL is-master-down-by-addr</code> 命令比起其他哨兵发送的相同命令都更快到达，并最终胜出领头哨兵的选举，然后这个领头哨兵就可以开始对主服务器执行故障转移操作了。</p>
</li>
</ol>
</li>
</ol>
<h3 id="29-故障转移">
  2.9 故障转移
  <a class="anchor" href="#29-%e6%95%85%e9%9a%9c%e8%bd%ac%e7%a7%bb">#</a>
</h3>
<ol>
<li>在选举产生出领头哨兵之后，<strong>领头哨兵将对已下线的主服务器进行故障转移操作</strong>，该操作包含以下步骤：
<ol>
<li><strong>在已下线主服务器属下的所有从服务器里面</strong>，<strong>挑选出一个从服务器</strong>，<strong>并将其转换为主服务器</strong>。</li>
<li><strong>让已下线主服务器属下的所有从服务器改为复制新的主服务器</strong>。</li>
<li><strong>将已下线主服务器设置为新的主服务器的从服务器</strong>，<strong>当这个旧的主服务器重新上线时</strong>，<strong>他就会成为新的主服务器的从服务器</strong>。</li>
</ol>
</li>
</ol>
<h4 id="291-选出新的主服务器">
  2.9.1 选出新的主服务器
  <a class="anchor" href="#291-%e9%80%89%e5%87%ba%e6%96%b0%e7%9a%84%e4%b8%bb%e6%9c%8d%e5%8a%a1%e5%99%a8">#</a>
</h4>
<ol>
<li>故障转移操作第一步要做的就是<strong>在已下线主服务器属下的所有从服务器中</strong>，<strong>挑选出一个状态良好</strong>、<strong>数据完整的从服务器</strong>，<strong>然后向这个从服务器发送 <code>SLAVEOF no one</code>命令</strong>，<strong>将这个从服务器转换为主服务器</strong>，具体的挑选主服务器的方法如下：
<ol>
<li><strong>领头哨兵会将已下线主服务器的所有从服务器保存到一个列表里面</strong>，然后按照以下规则，一项一项地对列表进行过滤：
<ol>
<li><strong>删除列表中所有处于下线或者断线状态的从服务器</strong>，这样可以<strong>保证列表中剩余的从服务器都是正常在线的</strong>。</li>
<li><strong>删除列表中所有最近5秒内没有回复过领头哨兵的 <code>INFO</code>命令的从服务器</strong>，这样可以<strong>保证列表中剩余的从服务器都是最近成功进行过通信的</strong>。</li>
<li><strong>删除所有与已下线主服务器连接断开超过 <code>down-after-millionseconds * 10</code>毫秒的从服务器</strong>，<code>down-after-millionseconds</code>选项指定了判断主服务器下线所需的时间，而删除断开时长超过<code>down-after-millionseconds * 10</code>毫秒的从服务器，则可以<strong>保证列表中剩余的从服务器都没有过早地与主服务器断开连接</strong>，换句话说，<strong>列表中剩余的从服务器保存的数据都是比较新的</strong>。</li>
</ol>
</li>
<li>之后，领头哨兵将<strong>根据从服务器的优先级</strong>，<strong>对列表中剩余的从服务器进行排序</strong>，<strong>并选出其中优先级最高的从服务器</strong>。</li>
<li><strong>如果有多个具有相同最高优先级的从服务器</strong>，<strong>那么领头哨兵将按照从服务器的复制偏移量</strong>，<strong>对具有相同最高优先级的所有从服务器进行排序</strong>，<strong>并选出其中偏移量最大的从服务器</strong>（复制偏移量最大的从服务器就是保存着最新数据的从服务器）。</li>
<li>最后，<strong>如果有多个 优先级最高</strong>、<strong>复制偏移量最大的从服务器</strong>，<strong>那么领头哨兵将按照运行ID对这些从服务器进行排序</strong>，<strong>并选出其中运行ID最小的从服务器</strong>。</li>
</ol>
</li>
<li><strong>在发送 <code>SLAVEOF no one</code>命令之后</strong>，<strong>领头哨兵会以每秒一次的频率</strong>（平时是每十秒一次），<strong>向被升级的从服务器发送 <code>INFO</code>命令</strong>，<strong>并观察命令回复中的角色信息</strong>，<strong>当被升级服务器的角色从原来的 <code>slave</code>变为 <code>master</code>时</strong>，<strong>领头哨兵就知道被选中的从服务器已经顺利升级为主服务器了</strong>。</li>
<li>具体实例如下：
<ol>
<li>
<p>下图展示了再一次故障转移操作中，领头哨兵向被选中的从服务器 <code>server2</code>发送 <code>SLAVEOF no one</code>命令的情形：</p>
<p>
  <img src="../../../media/202111/2021-11-20_145244_555813.png" alt="" /></p>
</li>
<li>
<p>领头哨兵会一直向 <code>server2</code>发送 <code>INFO</code>命令，当 <code>server2</code>返回的命令回复从</p>
<p>
  <img src="../../../media/202111/2021-11-20_145418_902803.png" alt="" /></p>
<p>变为</p>
<p>
  <img src="../../../media/202111/2021-11-20_145535_025365.png" alt="" /></p>
<p>的时候，领头哨兵就知道 <code>server2</code>已经成功升级为主服务器了。</p>
</li>
<li>
<p>下图展示了 <code>server2</code>升级成功之后，各个服务器和领头哨兵的样子：</p>
<p>
  <img src="../../../media/202111/2021-11-20_145732_506831.png" alt="" /></p>
</li>
</ol>
</li>
</ol>
<h4 id="292-修改从服务器的复制目标">
  2.9.2 修改从服务器的复制目标
  <a class="anchor" href="#292-%e4%bf%ae%e6%94%b9%e4%bb%8e%e6%9c%8d%e5%8a%a1%e5%99%a8%e7%9a%84%e5%a4%8d%e5%88%b6%e7%9b%ae%e6%a0%87">#</a>
</h4>
<ol>
<li>
<p><strong>当新的主服务器出现之后</strong>，<strong>领头哨兵下一步要做的就是</strong>，<strong>让已下线主服务器属下的所有从服务器去复制新的主服务器</strong>，<strong>这一动作可以通过向从服务器发送 <code>SLAVEOF</code>命令来实现</strong>。</p>
</li>
<li>
<p>下图展示了在故障转移操作中，领头哨兵向已下线主服务器 <code>server1</code>的两个从服务器 <code>server3</code>和 <code>server4</code>发送 <code>SLAVEOF</code>命令，让他们复制新的主服务器 <code>server2</code>：</p>
<p>
  <img src="../../../media/202111/2021-11-20_150151_307622.png" alt="" /></p>
</li>
<li>
<p>下图展示了 <code>server3</code>和 <code>server4</code>成为 <code>server2</code>的从服务器之后，各个服务器以及领头哨兵的样子：</p>
<p>
  <img src="../../../media/202111/2021-11-20_150345_558279.png" alt="" /></p>
</li>
</ol>
<h4 id="293-将旧的主服务器变为从服务器">
  2.9.3 将旧的主服务器变为从服务器
  <a class="anchor" href="#293-%e5%b0%86%e6%97%a7%e7%9a%84%e4%b8%bb%e6%9c%8d%e5%8a%a1%e5%99%a8%e5%8f%98%e4%b8%ba%e4%bb%8e%e6%9c%8d%e5%8a%a1%e5%99%a8">#</a>
</h4>
<ol>
<li>故障转移操作最后要做的是，<strong>将已下线的主服务器设置为新的主服务器的从服务器</strong>，<strong>因为旧的主服务器已经下线</strong>，<strong>所以这种设置是保存在旧的主服务器对应的实例结构里面的</strong>，<strong>当旧的主服务器重新上线时</strong>，<strong>哨兵就会向他发送 <code>SLAVEOF</code>命令</strong>，<strong>让他成为新的主服务器的从服务器</strong>。</li>
<li>具体实例如下：
<ol>
<li>
<p>下图展示了被领头哨兵设置为从服务器之后，服务器 <code>server1</code>的样子：</p>
<p>
  <img src="../../../media/202111/2021-11-20_150921_876651.png" alt="" /></p>
</li>
<li>
<p>下图展示了 <code>server1</code>重新上线并成为 <code>server2</code>的从服务器的例子：</p>
<p>
  <img src="../../../media/202111/2021-11-20_151207_425490.png" alt="" /></p>
</li>
</ol>
</li>
</ol>
<h2 id="参考文献">
  参考文献
  <a class="anchor" href="#%e5%8f%82%e8%80%83%e6%96%87%e7%8c%ae">#</a>
</h2>
<ol>
<li>redis 设计与实现（第二版）。</li>
</ol>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





  <div>
    <a class="flex align-center" href="https://github.com/graysonwp/ComputerCookbook-SchoolRecruitment/edit/main/exampleSite/content/docs/database/3%e3%80%81Redis/3.5%20%e9%ab%98%e5%8f%af%e7%94%a8/3.5.2%20%e5%93%a8%e5%85%b5%e6%a8%a1%e5%bc%8f.md" target="_blank" rel="noopener">
      <img src="/school-recruitment/svg/edit.svg" class="book-icon" alt="Edit" />
      <span>Edit this page</span>
    </a>
  </div>


<div id="gitalk-container" style="width : 100%;"></div>
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script src="https://rawgit.com/qhh0205/78e9e0b1f3114db6737f3ed8cdd51d3a/raw/3894c5be5aa2378336b1f5ee0f296fa0b22d06e9/md5.min.js"></script>
<script>
  const gitalk = new Gitalk({
    clientID: '94880e59f97ce511eb59',
    clientSecret: '025de6989c2398fdb4bfc398994541421fe6d32b',
    repo: 'ComputerCookbook-SchoolRecruitment',
    owner: 'graysonwp',
    admin: ['graysonwp'],
    id: md5(location.pathname), 
    distractionFreeMode: false, 
    body: location.href, 
    proxy: 'https:\/\/shielded-brushlands-08810.herokuapp.com\/https:\/\/github.com\/login\/oauth\/access_token' 
  });
  (function() {
    if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
      document.getElementById('gitalk-container').innerHTML = 'Gitalk comments not available by default when the website is previewed locally.';
      return;
    }
    gitalk.render('gitalk-container');
  })();
</script>


</div>



  <script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#哨兵模式">哨兵模式</a>
      <ul>
        <li><a href="#1-概述">1 概述</a></li>
        <li><a href="#2-原理">2 原理</a>
          <ul>
            <li><a href="#21-初始化哨兵">2.1 初始化哨兵</a>
              <ul>
                <li><a href="#211-初始化服务器">2.1.1 初始化服务器</a></li>
                <li><a href="#212-使用哨兵专用代码">2.1.2 使用哨兵专用代码</a></li>
                <li><a href="#213-初始化哨兵状态">2.1.3 初始化哨兵状态</a></li>
                <li><a href="#214-初始化哨兵状态的-masters-属性">2.1.4 初始化哨兵状态的 masters 属性</a></li>
                <li><a href="#215-创建连向主服务器的网络连接">2.1.5 创建连向主服务器的网络连接</a></li>
              </ul>
            </li>
            <li><a href="#22-获取主服务器信息">2.2 获取主服务器信息</a></li>
            <li><a href="#23-获取从服务器信息">2.3 获取从服务器信息</a></li>
            <li><a href="#24-向主服务器和从服务器发送信息">2.4 向主服务器和从服务器发送信息</a></li>
            <li><a href="#25-接收来自主服务器和从服务器的频道信息">2.5 接收来自主服务器和从服务器的频道信息</a>
              <ul>
                <li><a href="#251-更新-sentinels-字典">2.5.1 更新 sentinels 字典</a></li>
                <li><a href="#252-创建连向其他哨兵的命令连接">2.5.2 创建连向其他哨兵的命令连接</a></li>
              </ul>
            </li>
            <li><a href="#26-检测主观下线状态">2.6 检测主观下线状态</a></li>
            <li><a href="#27-检查客观下线状态">2.7 检查客观下线状态</a>
              <ul>
                <li><a href="#271-发送-sentinel-is-master-down-by-addr-命令">2.7.1 发送 SENTINEL is-master-down-by-addr 命令</a></li>
                <li><a href="#272-接收-sentinel-is-master-down-by-addr-命令">2.7.2 接收 SENTINEL is-master-down-by-addr 命令</a></li>
                <li><a href="#273-接收-sentinel-is-master-down-by-addr-命令的回复">2.7.3 接收 SENTINEL is-master-down-by-addr 命令的回复</a></li>
              </ul>
            </li>
            <li><a href="#28-选举领头哨兵">2.8 选举领头哨兵</a></li>
            <li><a href="#29-故障转移">2.9 故障转移</a>
              <ul>
                <li><a href="#291-选出新的主服务器">2.9.1 选出新的主服务器</a></li>
                <li><a href="#292-修改从服务器的复制目标">2.9.2 修改从服务器的复制目标</a></li>
                <li><a href="#293-将旧的主服务器变为从服务器">2.9.3 将旧的主服务器变为从服务器</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#参考文献">参考文献</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












